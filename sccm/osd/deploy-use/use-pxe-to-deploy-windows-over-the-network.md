---
title: "Использование PXE для развертывания Windows по сети | Документы Майкрософт"
description: "Для обновления операционной системы компьютера или установки новой версии Windows на новом компьютере можно использовать развертывания операционных систем PXE."
ms.custom: na
ms.date: 06/15/2017
ms.prod: configuration-manager
ms.reviewer: na
ms.suite: na
ms.technology: configmgr-osd
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: da5f8b61-2386-4530-ad54-1a5c51911f07
caps.latest.revision: "19"
caps.handback.revision: "0"
author: mattbriggs
ms.author: mabrigg
manager: angrobe
ms.openlocfilehash: b88ab3799027c78a8c605e934b247097b31e1d21
ms.sourcegitcommit: 51fc48fb023f1e8d995c6c4eacfda7dbec4d0b2f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2017
---
# <a name="use-pxe-to-deploy-windows-over-the-network-with-system-center-configuration-manager"></a>Использование PXE для развертывания Windows по сети с помощью System Center Configuration Manager

*Применимо к: System Center Configuration Manager (Current Branch)*

Развертывания операционной системы, инициированные протоколом удаленной загрузки (PXE) в System Center Configuration Manager, позволяют клиентским компьютерам запрашивать и развертывать операционные системы по сети. В этом сценарии развертывания вы отправляете образ операционной системы и образы загрузки Windows PE (семейств x86 и x64) в точку распространения, настроенную принимать запросы на загрузку PXE.

> [!NOTE]  
>  Когда вы создаете развертывание операционной системы, предназначенной только для 64-разрядных компьютеров с BIOS, в точке распространения должны быть доступны образы загрузки операционных систем обоих семейств (х64 и х86).

Вы можете использовать развертывания операционных систем, инициализированные PXE, в следующих сценариях развертывания:

-   [Обновление существующего компьютера до новой версии Windows](refresh-an-existing-computer-with-a-new-version-of-windows.md)  

-   [Установка новой версии Windows на новом компьютере (без операционной системы)](install-new-windows-version-new-computer-bare-metal.md)  

Выполните шаги, указанные для одного из сценариев развертывания операционной системы, а затем используйте следующие разделы для подготовки к развертываниям, инициируемым PXE.

##  <a name="BKMK_Configure"></a> Настройка по меньшей мере одной точки распространения для приема PXE-запросов
Чтобы развернуть операционные системы на клиентах, отправляющих запросы на загрузку PXE, используйте одну или несколько точек распространения, настроенных обрабатывать запросы на загрузку PXE. Шаги по включению PXE в точке распространения см. в разделе [Настройка точек распространения для приема PXE-запросов](../get-started/prepare-site-system-roles-for-operating-system-deployments.md#BKMK_PXEDistributionPoint).

## <a name="prepare-a-pxe-enabled-boot-image"></a>Подготовка загрузочного образа с поддержкой PXE
Чтобы использовать PXE для развертывания операционной системы, необходимо иметь загрузочные образы x86 и x64 с поддержкой PXE, передаваемые на одну или несколько точек распространения с поддержкой PXE. Используйте приведенные сведения, чтобы включить PXE для образа загрузки и распространить образ в точки распространения:

-   Чтобы включить PXE в образе загрузки, выберите параметр **Раз. загрузочный образ из точки распр., поддерживающей PXE** на вкладке **Источник данных** в свойствах образа загрузки.

-   Если вы изменяете свойства образа загрузки, повторно распространите этот образ в точки распространения. Дополнительные сведения см. в разделе [Распространение содержимого](../../core/servers/deploy/configure/deploy-and-manage-content.md#a-namebkmkdistributea-distribute-content).

##  <a name="BKMK_PXEExclusionList"></a> Создание списка исключений для PXE-развертываний
При использовании PXE для развертывания операционных систем вы можете создать список исключений для каждой точки распространения. Добавьте MAC-адреса в список исключений компьютеров, которые будут игнорироваться точкой распространения. Включенные в список компьютеры не будут получать последовательности задач развертывания, которые Configuration Manager использует для развертывания PXE.

#### <a name="to-create-the-exclusion-list"></a>Создание списка исключений

1.  На точке распространения, поддерживающей PXE, создайте текстовый файл. Например, этому файлу можно назначить имя **pxeExceptions.txt**.

2.  Используйте обычный текстовый редактор, например Блокнот. Внесите в список MAC-адреса компьютеров, которые будут игнорироваться точкой распространения с поддержкой PXE. MAC-адреса в списке необходимо разделять двоеточием и вводить каждый адрес с новой строки. Пример: `01:23:45:67:89:ab`

3.  Сохраните текстовый файл на сервере системы сайта точки распространения, поддерживающем PXE. Текстовый файл можно сохранить в любом расположении на сервере.

4.  Измените реестр точки распространения с поддержкой PXE, чтобы создать раздел реестра **MACIgnoreListFile**. Добавьте строковое значение полного пути к текстовому файлу на сервере системы сайта точки распространения с поддержкой PXE. Используйте приведенные ниже пути реестра.

     **HKLM\Software\Microsoft\SMS\DP**  

    > [!WARNING]  
    >  При неправильном использовании редактора реестра могут возникнуть серьезные проблемы, из-за которых может понадобиться переустановить операционную систему. Корпорация Майкрософт не гарантирует решения проблем, вызванных неправильным использованием редактора реестра. Ответственность за использование редактора реестра лежит на пользователе.

     После внесения изменений в реестр перезагружать сервер не требуется.

##  <a name="BKMK_RamDiskTFTP"></a>Размер блока и размер окна RamDisk TFTP
Вы можете настраивать размеры блока RamDisk TFTP, а начиная с версии Configuration Manager 1606 также и размеры окна для точек распространения с поддержкой PXE. Если изменить настройки сети, это может привести к тому, что при скачивании образа загрузки произойдет ошибка тайм-аута из-за слишком большого размера блока или окна. Настройка размеров блока и окна RamDisk TFTP позволяет оптимизировать трафик TFTP при использовании PXE для соответствия определенным требованиям сети. Чтобы определить наиболее эффективный вариант, протестируйте настраиваемые параметры в среде пользователя. Дополнительные сведения см. в разделе [Настройка размеров блока и окна RamDisk TFTP в точках распространения с поддержкой PXE](../get-started/prepare-site-system-roles-for-operating-system-deployments.md#BKMK_RamDiskTFTP).

## <a name="configure-deployment-settings"></a>Настройка параметров развертывания
Чтобы использовать инициируемое PXE развертывание операционной системы, необходимо настроить его на предоставление запросам на загрузку PXE доступа к операционной системе. Доступные операционные системы можно настроить на странице **Параметры развертывания** мастера развертывания программного обеспечения или на вкладке **Параметры развертывания** в свойствах развертывания. Для параметра **Сделать доступной для** настройте одно из следующих значений:

-   Клиенты Configuration Manager, носители и PXE

-   Только носители и PXE

-   Только носители и PXE (скрытые)

##  <a name="BKMK_Deploy"></a> Развертывание последовательности задач
Выполните развертывание операционной системы в целевой коллекции. Дополнительные сведения см. в статье [Deploy a task sequence](manage-task-sequences-to-automate-tasks.md#BKMK_DeployTS). При развертывании операционных систем с помощью PXE можно настроить, является ли это развертывание обязательным или доступным.

-   **Обязательное развертывание**. При обязательных развертываниях PXE используется без вмешательства пользователя. При этом пользователь не может обойти загрузку PXE. Если пользователь отменит загрузку PXE до получения ответа от точки распространения, операционная система не будет развернута.

-   **Доступное развертывание**. Доступные развертывания требуют присутствия пользователя на конечном компьютере (и нажатия им клавиши F12 для продолжения процесса PXE-загрузки). Если пользователь отсутствует и не может нажать клавишу F12, то компьютер загрузится с использованием текущей операционной системы или со следующего доступного загрузочного устройства.

Чтобы повторно развернуть обязательное развертывание PXE, можно очистить состояние последнего развертывания PXE, назначенного компьютеру или коллекции Configuration Manager. Такое действие сбрасывает состояние этого развертывания и выполняет повторную установку последних обязательных развертываний.

> [!IMPORTANT]
> Протокол PXE не является безопасным. PXE-сервер и клиент PXE должны находиться в физически защищенной сети (например, в центре обработки данных); это позволит избежать несанкционированного доступа к сайту.

##  <a name="how-is-the-boot-image-selected-for-clients-booting-with-pxe"></a>Каким образом выбирается загрузочный образ для загрузки клиентов с помощью PXE?
Когда клиент загружается с помощью PXE, Configuration Manager предоставляет клиенту загрузочный образ. Начиная с версии 1606 Configuration Manager использует образ загрузки, архитектура которого точно соответствует архитектуре клиента. Если образ загрузки с такой архитектурой недоступен, Configuration Manager использует образ загрузки с совместимой архитектурой. Ниже приведены сведения о порядке выбора загрузочного образа для клиентов, загрузка которых выполняется с помощью PXE.
1. Configuration Manager выполняет в базе данных сайта поиск системной записи, соответствующей MAC-адресу или имени SMBIOS загружаемого клиента.  

    > [!NOTE]
    > Если компьютер, назначенный сайту, загружается с помощью PXE для другого сайта, политики будут недоступны для этого компьютера. Например, если клиент уже назначен сайту А, точка управления и точка распространения для сайта Б не будут иметь доступ к политикам с сайта А. Следовательно, клиент не загрузится с помощью PXE.

2. Configuration Manager ищет последовательности задач, которые развертываются для системной записи, найденной в шаге 1.

3. В списке последовательностей задач, найденных в шаге 2, Configuration Manager ищет загрузочный образ, соответствующий архитектуре клиента, который пытается выполнить загрузку. При обнаружении загрузочного образа с нужной архитектурой он используется для загрузки клиента.

4. Если образ загрузки с той же архитектурой не найден, Configuration Manager ищет образ загрузки, совместимый с архитектурой клиента. Поиск выполняется в списке последовательностей задач, найденных на шаге 2. Например, 64-разрядный клиент совместим с 32- и 64-разрядными загрузочными образами. 32-разрядный клиент совместим только с 32-разрядными загрузочными образами. Клиент с UEFI совместим только с 64-разрядными образами загрузки.
