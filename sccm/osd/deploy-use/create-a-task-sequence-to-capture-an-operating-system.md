---
title: "Создание последовательности задач для записи операционной системы | Документы Майкрософт"
description: "Последовательность задач сборки и записи для создания компьютера-образца, который может содержать специальные драйверы и обновления программного обеспечения вместе с операционной системой."
ms.custom: na
ms.date: 10/06/2016
ms.prod: configuration-manager
ms.reviewer: na
ms.suite: na
ms.technology: configmgr-osd
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 25e4ac68-0e78-4bbe-b8fc-3898b372c4e8
caps.latest.revision: "19"
caps.handback.revision: "0"
author: Dougeby
ms.author: dougeby
manager: angrobe
ms.openlocfilehash: e9320e40b8e5031ffa3da5e5149c7da718cc87d5
ms.sourcegitcommit: 51fc48fb023f1e8d995c6c4eacfda7dbec4d0b2f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2017
---
# <a name="create-a-task-sequence-to-capture-an-operating-system-in-system-center-configuration-manager"></a>Создание последовательности задач для записи операционной системы в System Center Configuration Manager

*Применимо к: System Center Configuration Manager (Current Branch)*

При использовании последовательности задач для развертывания операционной системы на компьютере в System Center Configuration Manager этот компьютер устанавливает образ операционной системы, указанный в последовательности задач. Чтобы настроить образ операционной системы, включив в него специальные драйверы, приложения, обновления программного обеспечения и т. п., используется последовательность задач создания и записи, позволяющая создать компьютер-образец, а затем записать с него образ операционной системы. Если у вас уже есть доступный для записи компьютер-образец, можно создать настраиваемую последовательность задач для записи операционной системы. Используйте сведения из следующих разделов для записи настраиваемой операционной системы.  

##  <a name="BKMK_BuildCaptureTS"></a> Использование последовательности задач для создания и записи компьютера-образца  
 Последовательность задач создания и записи осуществляет секционирование и форматирование компьютера-образца, устанавливает операционную систему, клиент Configuration Manager, приложения и обновления программного обеспечения, а затем записывает операционную систему с компьютера-образца. Перед созданием последовательности задач создания и записи в точках распространения должны быть доступны пакеты, связанные с последовательностью задач, например приложения.  

###  <a name="BKMK_CreatePackages"></a> Подготовка к развертываниям операционной системы  
 Существует множество сценариев развертывания операционной системы на компьютерах в вашей среде. В большинстве случаев вы создадите последовательность задач и выберите **Установить существующий образ** в мастере создания последовательности задач, чтобы установить операционную систему, перенести параметры пользователя, применить обновления программного обеспечения и установить приложения. Перед созданием последовательности задач для установки операционной системы должны быть выполнены следующие условия:  

-   **Обязательное**  

    -   [Загрузочный образ](../get-started/manage-boot-images.md) должен быть доступен в консоли Configuration Manager.  

    -   [Образ операционной системы](../get-started/manage-operating-system-images.md) должен быть доступен в консоли Configuration Manager.  

-   **Обязательно (если используется)**  

    -   [Пакеты драйверов](../get-started/manage-drivers.md), содержащие необходимые драйверы Windows для поддержки оборудования на компьютере-образце, должны быть доступны в консоли Configuration Manager. Дополнительные сведения о шагах последовательности задач для управления драйверами см. в статье [Использование последовательностей задач для установки драйверов устройств](../get-started/manage-drivers.md#BKMK_TSDrivers).  

    -   [Обновления программного обеспечения](../../sum/get-started/synchronize-software-updates.md) должны быть синхронизированы в консоли Configuration Manager.  

    -   [Приложения](../../apps/deploy-use/create-applications.md) должны быть добавлены в консоль Configuration Manager.  

###  <a name="BKMK_CreateBuildCaptureTS"></a> Создание последовательности задач создания и записи  
 Используйте следующую процедуру, чтобы воспользоваться последовательностью задач для создания компьютера-образца и записи операционной системы.  

#### <a name="to-create-a-task-sequence-that-builds-and-captures-an-operating-system-image"></a>Создание последовательности задач для создания образа операционной системы и сбора для него данных  

1.  В консоли Configuration Manager щелкните **Библиотека программного обеспечения**.  

2.  В рабочей области **Библиотека программного обеспечения** разверните узел **Операционные системы**и выберите элемент **Последовательности задач**.  

3.  В группе **Создать** вкладки **Главная** выберите команду **Создать последовательность задач** , чтобы запустить мастер создания последовательности задач.  

4.  На странице **Создание новой последовательности задач** щелкните **Создать и сохранить мастер-образ операционной системы**.  

5.  На странице **Сведения о последовательности задач** настройте следующие параметры, затем нажмите кнопку **Далее**.  

    -   **Имя последовательности задач**. Укажите имя последовательности задач.  

    -   **Описание**. Введите описание задачи, выполняющейся последовательностью. Например, описание операционной системы, создаваемой последовательностью задач.  

    -   **Загрузочный образ**. Укажите образ загрузки, используемый для установки образа операционной системы.  

        > [!IMPORTANT]  
        >  Архитектура загрузочного образа должна быть совместимой с архитектурой оборудования конечного компьютера.  

6.  На странице **Установка Windows** настройте следующие параметры, затем нажмите кнопку **Далее**.  

    -   **Пакет образа**. Укажите пакет образа операционной системы, который содержит файлы, необходимые для установки операционной системы.  

    -   **Индекс образа**. Укажите устанавливаемую операционную систему. Если образ операционной системы содержит несколько версий, выберите версию, которую необходимо установить.  

    -   **Ключ продукта**. Введите ключ продукта для устанавливаемой операционной системы Windows. Можно указать зашифрованные ключи многократной установки или стандартные ключи продукта. В незашифрованном ключе знаки сгруппированы по 5 и разделены дефисами (-), Например, *XXXXX-XXXXX-XXXXX-XXXXX-XXXXX*  

    -   **Режим лицензирования сервера**. Выберите режим лицензирования сервера: **Для каждого рабочего места**, **Для каждого сервера**или не указывайте лицензию. В случае использования варианта **Для каждого сервера**следует также указать максимальное число подключений.  

    -   Укажите параметры обработки учетной записи администратора, использующейся при развертывании операционной системы.  

        -   **Задать произвольно пароль лок. администратора и отключить учетную запись лок. администратора на всех поддерживаемых платформах**. Укажите, требуется ли Configuration Manager создать случайный пароль для учетной записи локального администратора и отключить учетную запись при развертывании образа операционной системы.  

        -   **Включить учетную запись локального администратора и задать пароль**. Укажите, используется ли один и тот же пароль для учетной записи локального администратора на всех компьютерах, на которых развертывается операционная система.  

7.  На странице **Настроить сеть** настройте следующие параметры, затем нажмите кнопку **Далее**.  

    -   **Присоединить к рабочей группе**. Укажите, следует ли добавлять конечный компьютер к рабочей группе при развертывании операционной системы.  

    -   **Присоединить к домену**. Укажите, следует ли добавлять конечный компьютер к домену при развертывании операционной системы. Укажите имя домена в разделе **Домен**.  

        > [!IMPORTANT]  
        >  Чтобы указать домен из локального леса, достаточно просмотреть структуру последнего; в случае же с удаленным лесом необходимо знать (и ввести) имя домена.  

         Можно также указать подразделение (OU). Это необязательный параметр, содержащий различающееся имя подразделения в каталоге LDAP X.500, куда добавляется учетная запись компьютера, если она еще не создана.  

    -   **Учетная запись**. Введите имя пользователя и пароль учетной записи, которая может присоединиться к выбранному домену. Например: *domain\user* или *%variable%*.  

        > [!IMPORTANT]  
        >  Для переноса параметров домена или рабочей группы требуется ввод надлежащих учетных данных домена.  

8.  На странице **Установка Configuration Manager** укажите пакет клиента Configuration Manager, содержащий исходные файлы для установки клиента Configuration Manager, добавьте дополнительные свойства, необходимые для установки клиента, а затем нажмите кнопку **Далее**.  

     Дополнительные сведения о свойствах, которые можно использовать для установки клиента, см. в статье [Сведения о свойствах установки клиента](../../core/clients/deploy/about-client-installation-properties.md).  

9. На странице **Включить обновления** укажите, следует ли устанавливать только обязательные обновления ПО, все обновления или не устанавливать их вообще, и нажмите кнопку **Далее**. Если выбран вариант установки обновлений программного обеспечения, Configuration Manager устанавливает только те обновления ПО, которые относятся к коллекциям, в которые входит конечный компьютер.  

10. На странице **Установить приложения** укажите приложения, которые необходимо установить на конечный компьютер, а затем нажмите кнопку **Далее**. Если задано несколько приложений, можно настроить продолжение выполнения последовательности задач в случае сбоя установки определенного приложения.  

11. На странице **Подготовка системы** укажите следующие параметры, затем нажмите кнопку **Далее**.  

    -   **Пакет**. Укажите пакет Configuration Manager, содержащий подходящую версию программы Sysprep, которая будет использоваться для записи параметров компьютера-образца.  

         Если версией операционной системы, выполняющейся на компьютере, является Windows Vista или более поздняя, программа Sysprep автоматически установлена этом компьютере, поэтому нет необходимости указывать пакет.  

12. На странице **Свойства образа** укажите следующие параметры образа операционной системы и нажмите кнопку **Далее**.  

    -   **Автор**. Укажите имя пользователя, создавшего образ операционной системы.  

    -   **Версия**. Укажите номер версии, задаваемый пользователем, который будет связан с образом операционной системы.  

    -   **Описание**. Укажите описание, определяемое пользователем, для образа операционной системы компьютера.  

13. На странице **Запись образа** укажите следующие параметры, а затем нажмите кнопку **Далее**.  

    -   **Путь**. Укажите общую сетевую папку для хранения выходного WIM-файла. Этот файл содержит образ операционной системы, основанный на параметрах, указанных в мастере. Если задать папку, уже имеющую WIM-файл, существующий файл будет перезаписан.  

    -   **Учетная запись**. Укажите учетную запись Windows, имеющую разрешения на доступ к общей сетевой папке, где хранится образ.  

14. Завершите работу мастера.  

15. Чтобы добавить шаги в последовательность задач, выберите созданную последовательность задач и нажмите кнопку **Изменить**. Дополнительные сведения о редактировании последовательности задач см. в статье [Редактирование последовательности задач](manage-task-sequences-to-automate-tasks.md#BKMK_ModifyTaskSequence).  

 Разверните последовательность задач на компьютере-образце одним из следующих способов:  

-   Если компьютер-образец является клиентом Configuration Manager, разверните последовательность задач создания и записи в коллекцию, содержащую компьютер-образец. Дополнительные сведения о развертывании образа операционной системы см. в статье [Создание последовательности задач для установки операционной системы](create-a-task-sequence-to-install-an-operating-system.md).  

    > [!NOTE]  
    >  Если в последовательности задач присутствует шаг создания разделов на диске, не выбирайте параметр **Загрузить программу** при развертывании последовательности задач.  

-   Если компьютер-образец не является клиентом Configuration Manager или необходимо вручную выполнить последовательность задач на компьютере-образце, запустите **мастер создания носителя с последовательностью задач**, чтобы создать загрузочный носитель. Сведения о создании загрузочного носителя см. в разделе [Создание загрузочного носителя](create-bootable-media.md).  

##  <a name="BKMK_CaptureExistingRefComputer"></a> Запись образа операционной системы с существующего компьютера-образца  
 После подготовки компьютера-образца к записи можно создать последовательность задач, которая записывает операционную систему с компьютера-образца. Шаг последовательности задач **Записать образ операционной системы** используется для записи одного или нескольких образов с эталонного компьютера. Затем эти образы сохраняются в файл образа (WIM) в указанной сетевой папке. Компьютер-образец запускается в Windows PE с помощью образа загрузки. Каждый жесткий диск на компьютере-образце записывается в виде отдельного образа в WIM-файле. Если компьютер-образец имеет несколько дисков, получившийся WIM-файл будет содержать отдельный образ для каждого тома. Поддерживается запись только томов с файловыми системами NTFS или FAT32. Тома с другими форматами файловых систем и тома USB пропускаются.  

 Используйте следующую процедуру для записи образа операционной системы с существующего компьютера-образца.  

#### <a name="to-capture-an-operating-system-from-an-existing-reference-computer"></a>Порядок записи операционной системы с существующего компьютера-образца  

1.  В консоли Configuration Manager щелкните **Библиотека программного обеспечения**.  

2.  В рабочей области **Библиотека программного обеспечения** разверните узел **Операционные системы**и выберите элемент **Последовательности задач**.  

3.  В группе **Создать** вкладки **Главная** выберите команду **Создать последовательность задач** , чтобы запустить мастер создания последовательности задач.  

4.  На странице **Создание новой последовательности задач** выберите команду **Создание новой последовательности задач**.  

5.  На странице **Сведения о последовательности задач** укажите имя и описание для последовательности задач.  

6.  Укажите образ загрузки для последовательности задач. Этот образ загрузки используется для запуска компьютера-образца с помощью Windows PE.  Дополнительные сведения см. в разделе [Управление загрузочными образами](../get-started/manage-boot-images.md).  

7.  Завершите работу мастера.  

8.  В окне **Последовательности задач**выберите настраиваемую последовательность задач, а затем на вкладке **Главная** группы **Последовательность задач** щелкните **Изменить** , чтобы открыть редактор последовательности задач.  

9. Используйте этот шаг, только если на компьютере-образце установлен клиент Configuration Manager.  

     Нажмите кнопку **Добавить**, выберите **Образы** и щелкните [Подготовка клиента Configuration Manager перед снятием образа](../understand/task-sequence-steps.md#BKMK_PrepareConfigMgrClientforCapture). Этот шаг последовательности задач используется для обработки клиента Configuration Manager на компьютере-образце и его подготовки к включению в образ.  

10. Нажмите кнопку **Добавить**, выберите **Образы** и щелкните [Подготовка Windows перед снятием образа](../understand/task-sequence-steps.md#BKMK_PrepareWindowsforCapture). Этот действие последовательности задач выполняет программу Sysprep и затем перезагружает компьютер с помощью загрузочного образа Windows PE, определенного в последовательности задач. Чтобы это действие было выполнено успешно, компьютер-образец не должен входить в состав домена.  

11. Нажмите кнопку **Добавить**, выберите **Образы** и щелкните [Записать образ операционной системы](../understand/task-sequence-steps.md#BKMK_CaptureOperatingSystemImage).  Этот шаг последовательности задач выполняется только из Windows PE для записи жестких дисков на компьютере-образце. Настройте следующие параметры для этого шага последовательности задач.  

    -   **Имя** и **Описание**. При необходимости можно изменить имя шага последовательности и указать описание.  

    -   **Назначение**. Укажите общую сетевую папку для хранения выходного WIM-файла. Этот файл содержит образ операционной системы, основанный на параметрах, указанных в мастере. Если задать папку, уже имеющую WIM-файл, существующий файл будет перезаписан.  

    -   **Описание**, **Версия**и **Автор**. При необходимости укажите сведения о записываемом образе.  

    -   **Учетная запись "Записать образ операционной системы"**. Укажите учетную запись Windows, имеющую разрешения на доступ к заданной общей сетевой папке. Нажмите кнопку **Задать** , чтобы указать имя этой учетной записи Windows.  

     Нажмите кнопку **ОК** , чтобы закрыть редактор последовательности задач.  

 Разверните последовательность задач на компьютере-образце одним из следующих способов:  

-   Если компьютер-образец является клиентом Configuration Manager, разверните последовательность задач создания и записи в коллекцию, содержащую компьютер-образец. Дополнительные сведения о развертывании образа операционной системы см. в статье [Создание последовательности задач для установки операционной системы](create-a-task-sequence-to-install-an-operating-system.md).  

-   Если компьютер-образец не является клиентом Configuration Manager или необходимо вручную выполнить последовательность задач на компьютере-образце, запустите **мастер создания носителя с последовательностью задач**, чтобы создать загрузочный носитель. Сведения о создании загрузочного носителя см. в разделе [Создание загрузочного носителя](create-bootable-media.md).  

##  <a name="BKMK_BuildandCaptureTSExample"></a> Пример последовательности задач для создания и записи образа операционной системы  
 Приведенная ниже таблица представляет собой руководство, на которое можно опираться при создании последовательности задач, выполняющей создание образа операционной системы. Таблица поможет при выработке общей структуры шагов последовательности задач и объединении их в логические группы. Последовательность задач, созданная вами, может отличаться от представленного примера и включать в себя больше (или меньше) шагов и групп.  

> [!IMPORTANT]  
>  Для создания подобных последовательностей задач всегда используйте мастер создания последовательности задач.  

 При использовании функции **создания новой последовательности задач** для создания последовательности названия некоторых шагов будут отличаться от равнозначных им шагов, добавленных в существующую последовательность задач вручную. Различия в именовании представлены в следующей таблице.  

|Название шага в последовательности задач при использовании мастера создания новой последовательности задач|Название равнозначного шага в редакторе последовательности задач|  
|------------------------------------------------------|-----------------------------------------------|  
|Перезапустить в Windows PE|Перезагрузить в Windows PE или с жесткого диска|  
|Создать разделы на диске 0|Отформатировать диск и создать разделы|  
|Применить драйверы устройств|Автоматическое применение драйверов|  
|Установить обновления|Установить обновления программного обеспечения|  
|Присоединить к рабочей группе|Присоединить к домену или рабочей группе|  
|Подготовка клиента Configuration Manager|Prepare ConfigMgr Client for Capture|  
|Подготовить операционную систему|Prepare Windows for Capture|  
|Сделать образ с эталонного компьютера|Записать образ операционной системы|  

|Группа или шаг последовательности задач|Справочные сведения|  
|-------------------------------|---------------|  
|Создание компьютера-образца **(новая группа последовательности задач)**|Создание группы последовательности задач. Группа последовательности задач используется для группирования сходных шагов в целях повышения управляемости и упрощения управления ошибками.<br /><br /> В этой группе содержатся действия, необходимые для построения компьютера-образца.|  
|Перезапустить в Windows PE|Этот шаг последовательности задач используется для указания параметров перезагрузки для конечного компьютера. На этом шаге пользователю будет отображено сообщение, информирующее, что для продолжения установки компьютер будет перезагружен.<br /><br /> Этим шагом используется переменная последовательности задач **_SMSTSInWinPE** , доступная только для чтения. Если она имеет значение **false** , этот шаг будет выполнен.|  
|Создать разделы на диске 0|Этот шаг используется для указания действий, необходимых для форматирования жесткого диска на конечном компьютере. По умолчанию обрабатывается диск номер **0**.<br /><br /> Этим шагом используется переменная последовательности задач **_SMSTSClientCache** , доступная только для чтения. Этот шаг будет выполнен, если кэш клиентов Configuration Manager не существует.|  
|Применить операционную систему|Этот шаг используется для установки указанного образа операционной системы на конечный компьютер. На этом шаге все образы томов, хранящиеся в WIM-файле, применяются к соответствующим томам последовательного диска на конечном компьютере (при этом выполняется предварительное удаление всех файлов на обрабатываемых томах, за исключением файлов параметров, связанных с Configuration Manager).|  
|Применить настройки Windows|Этот шаг последовательности задач используется для настройки параметров Windows на конечном компьютере.|  
|Применить параметры сети|Этот шаг последовательности задач используется для задания параметров сети или рабочей группы на конечном компьютере.|  
|Применить драйверы устройств|Этот шаг используется для сопоставления и установки драйверов в ходе развертывания операционной системы. Программе установки Windows можно разрешить искать драйверы во всех существующих категориях, выбрав параметр **Использовать драйверы всех категорий** , или ограничить круг доступных категорий, выбрав **Использовать драйверы только из указанных категорий**.<br /><br /> Этим шагом используется переменная последовательности задач **_SMSTSMediaType** , доступная только для чтения. Этот шаг будет выполняться, если ее значение не равно **FullMedia** .|  
|Настройка Windows и Configuration Manager|Используйте этот шаг последовательности задач для установки клиентского программного обеспечения Configuration Manager. Configuration Manager устанавливает и регистрирует GUID клиента Configuration Manager. Необходимые параметры установки можно назначить в окне **Свойства установки** .|  
|Установить обновления|Этот шаг используется для указания способа установки обновлений программного обеспечения на конечный компьютер. Конечный компьютер не оценивается на наличие применимых обновлений программного обеспечения, пока не будет запущен этот шаг последовательности задач. На этом шаге конечный компьютер оценивается на применимость обновлений ПО, как и любой другой клиент, управляемый Configuration Manager.<br /><br /> Этим шагом используется переменная последовательности задач **_SMSTSMediaType** , доступная только для чтения. Этот шаг будет выполняться, если ее значение не равно **FullMedia** .|  
|Сбор данных с компьютера-образца **(новая группа последовательности задач)**|Создание еще одной группы последовательности задач. В этой группе содержатся шаги, необходимые для подготовки компьютера-образца и сбора с него данных.|  
|Присоединить к рабочей группе|Этот шаг используется для указания данных, необходимых для присоединения конечного компьютера к рабочей группе.|  
|Prepare ConfigMgr Client for Capture|Этот шаг используется для обработки клиента Configuration Manager на конечном компьютере и его подготовки к включению в образ.|  
|Подготовить операционную систему|Этот шаг используется для задания параметров Sysprep, используемых для сбора параметров Windows с компьютера-образца. В ходе этого шага происходит выполнение Sysprep с последующей перезагрузкой компьютера с использованием загрузочного образа среды предустановки Windows (Windows PE), указанного в последовательности задач.|  
|Записать образ операционной системы|Этот шаг используется для указания существующей сетевой папки и WIM-файла, используемых при сохранении образа. Это расположение используется в качестве исходного расположения пакета при добавлении пакета с образом операционной системы из **мастера добавления пакета образа операционной системы**.|  

 Создав образ операционной системы на основе эталонного компьютера, не используйте последний для создания другого образа, поскольку в ходе первоначальной настройки создаются записи реестра. Для создания каждого образа операционной системы используйте новый эталонный компьютер. Если вы планируете использовать тот же компьютер для создания других образов операционной системы, сначала удалите клиент Configuration Manager, а затем переустановите его.  

## <a name="next-steps"></a>Дальнейшие действия  
[Методы развертывания операционных систем предприятия](methods-to-deploy-enterprise-operating-systems.md)
