---
title: "Управление образами загрузки в Configuration Manager | Документы Майкрософт"
description: "Сведения об управлении в Configuration Manager загрузочными образами среды предустановки Windows, используемыми во время развертывания операционной системы."
ms.custom: na
ms.date: 01/23/2017
ms.prod: configuration-manager
ms.reviewer: na
ms.suite: na
ms.technology: configmgr-osd
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 97f2d81a-2c58-442c-88bc-defd5a1cd48f
caps.latest.revision: "23"
caps.handback.revision: "0"
author: Dougeby
ms.author: dougeby
manager: angrobe
ms.openlocfilehash: cc678c1133b1944f55bcad309cf9ede9f0660b57
ms.sourcegitcommit: 51fc48fb023f1e8d995c6c4eacfda7dbec4d0b2f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2017
---
# <a name="manage-boot-images-with-system-center-configuration-manager"></a>Управление образами загрузки для System Center Configuration Manager

*Применимо к: System Center Configuration Manager (Current Branch)*

Образ загрузки в Configuration Manager представляет собой образ [среды предустановки Windows (WinPE)](https://msdn.microsoft.com/library/windows/hardware/dn938389%28v=vs.85%29.aspx), используемый во время развертывания операционной системы. Образы загрузки используются для запуска компьютера в среде WinPE — миниатюрной операционной системе с ограниченным набором компонентов и служб, которые подготавливают конечный компьютер к установке Windows.  Управление загрузочными образами описано в следующих разделах.

## <a name="BKMK_BootImageDefault"></a> Образы загрузки по умолчанию
Configuration Manager предоставляет два образа загрузки по умолчанию: один для поддержки 32-разрядных (x86) платформ, а второй — для 64-разрядных (x64) платформ. Эти образы хранятся по следующему пути: \\\\*имя_сервера*>\SMS_<*код_сайта*>\osd\boot\\<*x64*> или <*i386*>. Образы загрузки по умолчанию обновляются или создаются повторно в зависимости от выполняемого вами действия.

Для любых действий, описанных в следующих разделах, обратите внимание на следующее.
- Исходные объекты драйверов должны быть допустимыми, включая исходные файлы драйверов, иначе драйверы не будут добавлены в образы загрузки на сайте.
- Образы загрузки, которые основаны не на образах по умолчанию, не изменяются, даже если они используют ту же версию среды Windows PE.
- Вам нужно распространить измененные образы загрузки в точки распространения.
- Вам нужно повторно создать все носители, использующие измененные образы загрузки.
- Если вы не хотите, чтобы ваши настроенные образы загрузки и образы загрузки по умолчанию обновлялись автоматически, не сохраняйте их в расположении по умолчанию.

> [!NOTE]
> Средство журнала трассировки Configuration Manager добавляется во все образы загрузки, добавляемые в **библиотеку программного обеспечения**. В среде Windows PE вы можете запустить средство журнала трассировки Configuration Manager, введя **CMTrace** в командной строке.  

### <a name="use-updates-and-servicing-to-install-the-latest-version-of-configuration-manager"></a>Использование обновлений и обслуживания для установки последней версии Configuration Manager
Начиная с версии 1702, если вы обновляете версию Windows ADK и затем устанавливаете последнюю версию Configuration Manager с помощью обновления и установки, Configuration Manager обновляет образы загрузки по умолчанию. Сюда входит новая версия среды Windows PE из обновленного набора Windows ADK, новая версия клиента Configuration Manager, драйверы, настройки и т. д. Пользовательские образы загрузки не изменяются.

При использовании версии, предшествующей 1702, Configuration Manager обновляет существующий образ загрузки (boot.wim) с клиентскими компонентами, драйверами, настройками и т. д., но не использует последнюю версию среды Windows PE из набора Windows ADK. Вам нужно вручную изменить образ загрузки, чтобы использовать новую версию Windows ADK.

### <a name="upgrade-from-configuration-manager-2012-to-configuration-manager-current-branch-cb"></a>Миграция с Configuration Manager 2012 на Configuration Manager Current Branch (CB)
При обновлении Configuration Manager 2012 до Configuration Manager CB с помощью программы установки Configuration Manager повторно создает образы загрузки по умолчанию. Сюда входит новая версия среды Windows PE из обновленного набора Windows ADK, новая версия клиента Configuration Manager, а все настройки остаются неизменными. Пользовательские загрузочные образы не изменяются.

### <a name="update-distribution-points-with-the-boot-image"></a>Обновление точек распространения с использованием образа загрузки
Когда вы используете действие **Обновить точки распространения** из узла **Загрузочные образы** в консоли Configuration Manager, это средство дополняет образы загрузки по умолчанию клиентскими компонентами, драйверами, настройками и т. д.    

Начиная с Configuration Manager версии 1706 вы можете заново сохранить в образ загрузки последнюю версию Windows PE (из каталога установки Windows ADK). На странице **Общие** мастера обновления точек распространения предоставлены сведения о версии Windows ADK, установленной на сервере сайта, о версии Windows ADK, из которой в загрузочном образе использовался экземпляр Windows PE, а также о версии клиента Configuration Manager. Эти сведения помогут вам решить, следует ли повторно использовать загрузочный образ. Кроме того, добавлен новый столбец (**Версия клиента**), доступный при просмотре загрузочных образов на узле **Загрузочные образы** и отображающий версию клиента Configuration Manager, используемую для каждого загрузочного образа.    

Пользовательские загрузочные образы не изменяются.

##  <a name="BKMK_BootImageCustom"></a> Настройка образа загрузки  
 Настроить или [изменить загрузочный образ](#BKMK_ModifyBootImages) можно из Configuration Manager, если этот образ основан на версии среды предустановки Windows из поддерживаемой версии Windows ADK. Когда сайт обновляется до новой версии и устанавливается новая версия Windows ADK, пользовательские образы загрузки (находящиеся не в расположении образов загрузки по умолчанию) не обновляются до новой версии Windows ADK. В этом случае вы больше не сможете настраивать образы загрузки в консоли Configuration Manager. Тем не менее они по-прежнему будут работать, как и до обновления.  

 Если образ загрузки основан на версии Windows ADK, отличной от установленной на сайте, для настройки образов загрузки необходимо использовать другой подход, например программу командной строки "Система обслуживания образов развертывания и управления ими (DISM)", которая входит в состав Windows AIK и Windows ADK. Дополнительные сведения см. в статье [Настройка загрузочных образов](customize-boot-images.md).  

##  <a name="BKMK_AddBootImages"></a> Добавление образа загрузки  

 Во время установки сайта Configuration Manager автоматически добавляет загрузочные образы на основе версии WinPE из поддерживаемой версии Windows ADK. В зависимости от версии Configuration Manager может поддерживаться возможность добавления загрузочных образов на основе другой версии WinPE из поддерживаемой версии Windows ADK.  При попытке добавления загрузочного образа, который содержит неподдерживаемую версию WinPE, произойдет ошибка.  

 Ниже приведены поддерживаемая версия Windows ADK, версия среды предустановки Windows, используемая как основа образа загрузки, который может быть настроен в консоли Configuration Manager, и версии среды предустановки Windows, используемые как основа образов загрузки, которые могут быть настроены с помощью DISM, а затем добавлены в указанную версию Configuration Manager.  

-   **Версия Windows ADK**  

     Windows ADK для Windows 10  

-   **Версии среды предустановки Windows для загрузочных образов с возможностью настройки в консоли Configuration Manager**  

     Windows PE 10  

-   **Поддерживаемые версии среды предустановки Windows для загрузочных образов без возможности настройки в консоли Configuration Manager**  

     Среда предустановки Windows 3.1<sup>1</sup> и среда предустановки Windows 5  

     <sup>1</sup> Образ загрузки можно добавить в Configuration Manager, только если он был создан на основе среды предустановки Windows 3.1. Установите дополнительный компонент Windows AIK для Windows 7 с пакетом обновления 1 (SP1), чтобы обновить Windows AIK для Windows 7 (на основе среды предустановки Windows 3) с помощью дополнительного компонента Windows AIK для Windows 7 с пакетом обновления 1 (SP1) (на основе среды предустановки Windows 3.1). Дополнительный компонент Windows AIK для Windows 7 с пакетом обновления 1 (SP1) можно загрузить из [Центра загрузки Майкрософт](http://www.microsoft.com/download/details.aspx?id=5188).  

     Например, если используется Configuration Manager, загрузочные образы из Windows ADK для Windows 10 (на основе среды предустановки Windows 10) можно настраивать в консоли Configuration Manager. Однако несмотря на то что загрузочные образы на основе Windows PE 5 поддерживаются, их необходимо настраивать с другого компьютера и использовать версию DISM, установленную вместе с Windows ADK для Windows 8. После этого загрузочный образ можно будет добавить в консоль Configuration Manager. Дополнительные сведения о настройке образа загрузки (добавлении дополнительных компонентов и драйверов), включении поддержки команд для образа загрузки, добавлении образа загрузки в консоль Configuration Manager и обновлении точек распространения с учетом образа загрузки см. в разделе [Настройка загрузочных образов](customize-boot-images.md).

 Ниже приведена процедура добавления загрузочного образа вручную.  

#### <a name="to-add-a-boot-image"></a>Добавление загрузочного образа  

1.  В консоли Configuration Manager щелкните **Библиотека программного обеспечения**.  

2.  В рабочей области **Библиотека программного обеспечения** разверните узел **Операционные системы**и выберите **Загрузочные образы**.  

3.  На вкладке **Главная** в группе **Создать** щелкните элемент **Добавить загрузочный образ** , чтобы запустить мастер добавления загрузочного образа.  

4.  На странице **Источник данных** настройте следующие параметры, затем нажмите кнопку **Далее**.  

    -   В поле **Путь** укажите путь к WIM-файлу загрузочного образа.  

         Указанный путь должен быть допустимым сетевым путем в формате UNC. Например: \\\\<*имя_сервера*\\<*имя_общей_папки*>\\<*имя_образа_загрузки*>.wim.  

    -   В раскрывающемся списке **Загрузочный образ** выберите загрузочный образ. Если в WIM-файле содержится несколько загрузочных образов, выберите соответствующий образ.  

5.  На странице **Общие**  укажите следующие параметры и нажмите кнопку **Далее**.  

    -   В поле **Имя** введите уникальное имя загрузочного образа.  

    -   В поле **Версия** введите номер версии загрузочного образа.  

    -   В поле **Комментарий** введите краткое описание порядка использования загрузочного образа.  

6.  Завершите работу мастера.  

 Загрузочный образ будет добавлен в узел **Загрузочный образ** консоли Configuration Manager. Однако прежде чем загрузочный образ можно будет использовать для развертывания операционной системы, его необходимо распространить в точки распространения, группы точек распространения или коллекции, которые связаны с группами точек распространения.  

> [!NOTE]  
>  При выборе узла **Загрузочный образ** в консоли Configuration Manager в столбце **Размер (КБ)** отображается размер каждого загрузочного образа без сжатия. Однако при отправке загрузочного образа по сети Configuration Manager использует его сжатую копию, размер которой обычно гораздо меньше, чем тот, который указан в столбце **Размер (КБ)**.  

##  <a name="BKMK_DistributeBootImages"></a> Распространение образов загрузки на точки распространения  
 Распространение загрузочных образов на точки распространения ничем не отличается от распространения другого содержимого. В большинстве случаев необходимо распространить загрузочный образ по крайней мере на одну точку распространения перед развертыванием операционной системы и созданием носителя.  

> [!NOTE]  
>  Чтобы использовать PXE для развертывания операционной системы, сделайте следующее перед распространением загрузочного образа:  
>   
>  -   Точку распространения необходимо настроить для приема PXE-запросов.  
> -   Образы в версиях для x86 и x64 необходимо распространить по крайней мере на одну точку распространения с поддержкой PXE.  
> -   Configuration Manager передает образы загрузки в папку **RemoteInstall** точки распространения с поддержкой PXE.  
>   
>  Дополнительные сведения об использовании PXE для развертывания операционных систем см. в статье [Использование PXE для развертывания Windows по сети](../deploy-use/use-pxe-to-deploy-windows-over-the-network.md).  

 Процедуры по распространению образа загрузки описаны в статье [Распространение содержимого](/sccm/core/servers/deploy/configure/deploy-and-manage-content#bkmk_distribute).  

##  <a name="BKMK_ModifyBootImages"></a> Изменение образа загрузки  
 Можно добавлять или удалять драйверы устройств в образ и изменять свойства, связанные с загрузочным образом. Добавляемыми или удаляемыми драйверами устройств могут быть и драйверы сетевых адаптеров или запоминающих устройств. При изменении загрузочных образов следует учитывать следующие факторы:  

-   Необходимо импортировать и включить драйверы устройств в каталог драйверов устройств, прежде чем добавлять их в загрузочный образ.  

-   При изменении загрузочного образа никакие связанные пакеты, на которые он ссылается, не изменяются.  

-   После внесения изменений в загрузочный образ необходимо **обновить** образ в точках распространения, на которых уже есть этот образ, чтобы везде была доступна последняя версия образа. Дополнительные сведения см. в статье [Управление распространенным содержимым](/sccm/core/servers/deploy/configure/deploy-and-manage-content#bkmk_manage).  

 Чтобы изменить загрузочный образ, выполните следующие действия.  

#### <a name="to-modify-the-properties-of-a-boot-image"></a>Изменение свойств загрузочного образа  

1.  В консоли Configuration Manager щелкните **Библиотека программного обеспечения**.  

2.  В рабочей области **Библиотека программного обеспечения** разверните узел **Операционные системы**и выберите **Загрузочные образы**.  

3.  Выберите загрузочный образ, свойства которого требуется изменить.  

4.  На вкладке **Главная** в группе **Свойства** щелкните **Свойства** , чтобы открыть диалоговое окно **Свойства** для загрузочного образа.  

5.  Настройте следующие параметры, чтобы изменить поведение загрузочного образа.  

    -   Если изменения в свойства загрузочного образа вносились с помощью внешнего средства, на вкладке **Образы** нажмите кнопку **Перезагрузить**.  

    -   На вкладке **Драйверы** добавьте драйверы устройств Windows, необходимые для загрузки WinPE. При добавлении драйверов устройств учтите следующие аспекты.  

        -   Выберите **Скрыть драйверы, которые не соответствуют архитектуре загрузочного образа**, чтобы отображались только драйверы, соответствующие архитектуре загрузочного образа. Архитектура основана на архитектуре, указанной в INF-файле производителя.  

        -   Выберите **Скрыть драйверы, которых нет в хранилище или классе сети (для загрузочных образов)** , чтобы отображались только драйверы запоминающих устройств и сетевые драйверы. Прочие драйверы, которые обычно не требуются для загрузочных образов (например, видеодрайверы или драйверы модемов), будут скрыты.  

        -   Выберите **Скрыть драйверы без цифровой подписи** , чтобы скрыть драйверы, не имеющие цифровой подписи.  

        -   В загрузочные образы рекомендуется добавлять только драйверы для сетевых карт и запоминающих устройств, если наличие других драйверов в составе WinPE не является обязательным.  

        -   Поскольку WinPE по умолчанию содержит большое число встроенных драйверов, добавляйте только те драйверы для сетевых карт и запоминающих устройств, которые не предоставляются ею.  

        -   Убедитесь, что добавляемые в образ загрузки драйверы соответствуют архитектуре этого образа.  

        > [!NOTE]  
        >  Драйверы устройств необходимо импортировать в каталог драйверов, прежде чем их можно будет добавить в загрузочный образ. Дополнительные сведения об импорте драйверов устройств см. в статье [Управление драйверами](manage-drivers.md).  

    -   На вкладке **Настройка** выберите любой из приведенных ниже параметров.  

        -   Установите флажок **Включить команду, выполняемую перед запуском** , чтобы указать команду, которая будет выполняться перед запуском последовательности задач. Если выполняемые перед запуском команды включены, можно затем указать командную строку для запуска, выбрать, требуются ли файлы поддержки для запуска команды, и указать исходное расположение таких файлов поддержки.  

            > [!WARNING]  
            >  Необходимо добавить **cmd /c** в начало командной строки. Если не указать **cmd /c**, окно ввода команд не будет закрыто после выполнения. Процесс развертывания продолжит ожидать завершения команды и не выполнит никаких прочих настроенных команд или действий.  

            > [!TIP]  
            >  Во время создания носителя с его файлами последовательность задач записывает ИД пакета и командную строку, выполняемую перед запуском, включая значения всех переменных последовательности задач, в файл журнала CreateTSMedia.log на компьютере, на котором запущена консоль Configuration Manager. В этом файле журнала можно проверить значения переменных последовательности задач.  

        -   Настройте параметры **Фон среды предустановки Windows** , чтобы указать, требуется ли использовать стандартный фон WinPE или настраиваемый фон.  

        -   Выберите **Включить поддержку командной строки (только для проверки)** , чтобы при развертывании загрузочного образа можно было открывать командную строку с помощью клавиши **F8** . Эта возможность может потребоваться при устранении неполадок, когда выполняется тестирование развертывания. Использование этого параметра в рабочей среде не рекомендуется.  

        -   Настройте рабочее пространство для Windows PE, которое будет временным хранилищем (ОЗУ-диском) в WinPE. Например, когда приложение запускается в среде WinPE и записывает временные файлы, WinPE перенаправляет их в пространство в памяти для имитации присутствия на жестком диске. По умолчанию WinPE выделяет 32 мегабайта (МБ) записываемой памяти.  

    -   На вкладке **Источник данных** измените любые из приведенных ниже параметров.  

        -   Задайте значения в полях **Путь к образу** и **Индекс образа** , чтобы изменить исходный файл загрузочного образа.  

        -   Установите флажок **Обновлять точки распространения по расписанию** , чтобы создать расписание для обновления загрузочного образа.  

        -   Выберите **Хранить содержимое в клиентском кэше** , чтобы запретить удаление содержимого пакета из клиентского кэша при необходимости освободить место для другого содержимого.  

        -   Выберите **Использовать двоичную дифференциальную репликацию** , чтобы указать, что в случае обновления пакета загрузочного образа на точке распространения необходимо распространять только измененные файлы. Использование этого параметра позволяет свести к минимум трафик между сайтами, особенно если пакет загрузочного образа большой, а изменения относительно незначительны.  

        -   Выберите **Раз. загрузочный образ из точки распр., поддерживающей PXE**, если образ загрузки используется для развертывания с поддержкой PXE.  

            > [!NOTE]  
            >  Дополнительные сведения см. в статье [Использование PXE для развертывания Windows по сети](../deploy-use/use-pxe-to-deploy-windows-over-the-network.md).  

    -   На вкладке **Доступ к данным** выберите любой из приведенных ниже параметров.  

        -   Настройте **параметры общей сетевой папки пакета** , если требуется, чтобы клиенты устанавливали содержимое пакета из сети.  

        -   Задайте **Параметры обновления пакета**, чтобы указать, каким образом Configuration Manager должен отключать пользователей от точки распространения. Обновление загрузочного образа может завершиться ошибкой, если пользователи подключены к точке распространения.  

    -   На вкладке **Параметры распространения** выберите любой из приведенных ниже параметров.  

        -   В списке **Приоритет распространения** укажите уровень приоритета, который Configuration Manager будет использовать при передаче нескольких пакетов на одну точку распространения.  

        -   Выберите **Распространять содержимое этого пакета в предпочтительные точки распространения** , чтобы включить передачу содержимого в предпочтительные точки распространения по запросу. При включении этого параметра точка управления передает содержимое на все предпочтительные точки распространения, когда клиент запрашивает содержимое пакета, и это содержимое недоступно на всех предпочтительных точках распространения.  

        -   Настройте **параметры предварительно подготовленной точки распространения** , чтобы указать способ передачи загрузочного образа на точки распространения, включенные для предварительно подготовленного содержимого.  

            > [!NOTE]  
            >  Дополнительные сведения о предварительно подготовленном содержимом см. в статье [Предварительная подготовка содержимого](/sccm/core/servers/deploy/configure/deploy-and-manage-content#bkmk_prestage).  

    -   На вкладке **Расположения содержимого** выберите точку распространения или группу точек распространения и выполните любые из приведенных ниже действий.  

        -   Нажмите кнопку **Повторить** , чтобы повторно передать загрузочный образ на выбранную точку распространения или в группу точек распространения.  

        -   Нажмите кнопку **Проверить** , чтобы проверить целостность пакета загрузочного образа на выбранной точке распространения или в группе точек распространения.  

    -   На вкладке **Необязательные компоненты** укажите компоненты, добавленные в среду предустановки Windows, для использования с Configuration Manager. Дополнительные сведения о доступных дополнительных компонентах см. в разделе [WinPE: добавление пакетов (Справочник по дополнительным компонентам)](https://msdn.microsoft.com/library/windows/hardware/dn938382\(v=vs.85\).aspx).  

    -   На вкладке **Безопасность** выберите администратора и внесите изменения в набор доступных для него действий.  

6.  Завершив настройку свойств, нажмите кнопку **ОК**.  

##  <a name="BKMK_BootImagePXE"></a> Настройка образа загрузки для развертывания из точки распространения с поддержкой PXE  
 Перед использованием образа загрузки для развертывания операционных систем по протоколу PXE необходимо настроить этот образ на развертывание из точки распространения с поддержкой PXE.  

#### <a name="to-configure-a-boot-image-to-deploy-from-a-pxe-enabled-distribution-point"></a>Настройка образа загрузки для развертывания из точки распространения с поддержкой PXE  

1.  В консоли Configuration Manager щелкните **Библиотека программного обеспечения**.  

2.  В рабочей области **Библиотека программного обеспечения** разверните узел **Операционные системы**и выберите **Загрузочные образы**.  

3.  Выберите загрузочный образ, свойства которого требуется изменить.  

4.  На вкладке **Главная** в группе **Свойства** щелкните **Свойства** , чтобы открыть диалоговое окно **Свойства** для загрузочного образа.  

5.  На вкладке **Источник данных** выберите **Раз. загрузочный образ из точки распр., поддерживающей PXE**.  

    > [!NOTE]  
    >  Дополнительные сведения см. в статье [Использование PXE для развертывания Windows по сети](../deploy-use/use-pxe-to-deploy-windows-over-the-network.md).  

6.  Завершив настройку свойств, нажмите кнопку **ОК**.  

##  <a name="BKMK_BootImageLanguage"></a> Настройка нескольких языков для развертывания образа загрузки  
 Загрузочные образы не зависят от языка. Это позволяет использовать один загрузочный образ, в котором последовательность задач будет отображать текст на нескольких языках в среде WinPE, если указать соответствующую языковую поддержку с дополнительными компонентами Windows PE и задать соответствующую переменную последовательности задач как true, чтобы указать, какой язык может быть отображен. Язык развертываемой операционной системы не зависит от языка, который будет отображаться в среде WinPE, независимо от версии Configuration Manager. Язык, который видит пользователь, определяется следующим образом:  

-   Когда пользователь запускает последовательность задач из существующей операционной системы, в Configuration Manager автоматически будет использован язык, настроенный для пользователя. Когда последовательность задач автоматически запускается принудительно в результате наступления срока развертывания, Configuration Manager использует язык операционной системы.  

-   При развертывании операционной системы с использованием PXE или носителя можно задать код языка в переменной SMSTSLanguageFolder в составе команды предварительного запуска. При запуске компьютера в среде WinPE сообщения отображаются на языке, указанном в переменной. Если при доступе к файлу языкового ресурса в указанной папке происходит ошибка или вы не установите переменные, сообщения отображаются на языке WinPE.  

    > [!NOTE]  
    >  Когда носитель защищен паролем, подсказка, запрашивающая у пользователя пароль, всегда отображается на языке WinPE.  

 Используйте следующую процедуру для установки языка WinPE для развертывания операционных систем с помощью PXE или носителей.  

#### <a name="to-set-the-windows-pe-language-for-a-pxe-or-media-initiated-operating-system-deployment"></a>Установка языка Windows PE для развертывания операционных систем с помощью PXE или носителей  

1.  Убедитесь, что соответствующий файл ресурсов последовательности задач (tsres.dll) находится в соответствующей языковой папке на сервере сайта, перед обновлением загрузочного образа. Например, файл ресурсов для английского языка находится в следующем расположении: <*папка_установки_ConfigMgr*>\OSD\bin\x64\00000409\tsres.dll.  

2.  В составе команды перед запуском задайте переменную среды SMSTSLanguageFolder, равную коду языка. Код языка должен быть указан с помощью десятичной, а не шестнадцатеричной записи. Например, чтобы установить английский язык, нужно указать десятичное значение 1033 вместо шестнадцатеричного значения 00000409, используемого в имени папки.  
