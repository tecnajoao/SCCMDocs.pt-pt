---
title: "Подготовка ролей системы сайта к развертываниям операционной системы | Документы Майкрософт"
description: "Настройте роли системы сайта перед развертыванием операционных систем в System Center Configuration Manager."
ms.custom: na
ms.date: 10/06/2016
ms.prod: configuration-manager
ms.reviewer: na
ms.suite: na
ms.technology: configmgr-osd
ms.tgt_pltfrm: na
ms.topic: get-started-article
ms.assetid: 0ef5f3ce-b0e4-4775-b5c2-b245e45b4194
caps.latest.revision: "11"
caps.handback.revision: "0"
author: Dougeby
ms.author: dougeby
manager: angrobe
ms.openlocfilehash: 11c0f169afebdb071fefb5ce300fd1ae3481a94f
ms.sourcegitcommit: 51fc48fb023f1e8d995c6c4eacfda7dbec4d0b2f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2017
---
# <a name="prepare-site-system-roles-for-operating-system-deployments-with-system-center-configuration-manager"></a>Подготовка ролей системы сайта к развертываниям операционной системы с помощью System Center Configuration Manager

*Применимо к: System Center Configuration Manager (Current Branch)*

Для развертывания операционных систем в System Center Configuration Manager необходимо сначала подготовить следующие роли системы сайта, требующие определенных конфигураций и рассмотрения:

##  <a name="BKMK_DistributionPoints"></a> точки распространения;  
 Роль системы сайта точки распространения, которая содержит исходные файлы для скачивания клиентами, такие как содержимое приложений, обновления программного обеспечения, образы операционных систем и загрузочные образы. Для контроля распространения содержимого можно использовать параметры пропускной способности, регулирования и планирования.  

 Важно иметь достаточное количество точек распространения для поддержки развертывания операционных систем на компьютерах. Также важно спланировать размещение этих точек распространения в вашей иерархии. Много полезных сведений о планировании можно найти в разделе [Управление содержимым и инфраструктурой содержимого](../../core/servers/deploy/configure/manage-content-and-content-infrastructure.md). Однако имеются и некоторые другие аспекты планирования для точек распространения, связанные с развертыванием операционной системы.  

###  <a name="BKMK_AdditionalPlanning"></a> Дополнительные аспекты планирования для точек распространения  
 Ниже приведены дополнительные аспекты планирования для точек распространения.  

-   **Как предотвратить нежелательные развертывания операционных систем?**  

     Configuration Manager не отличает серверы сайта от других конечных компьютеров в коллекции. При развертывании нужной последовательности задач в коллекции с сервером сайта выполнение последовательности на этом сервере ничем не будет отличаться от ее выполнения на любом другом компьютере в коллекции. Убедитесь, что развертывание операционной системы использует коллекцию с теми клиентами, на которых требуется выполнить такое развертывание.  

     Вы можете управлять поведением развертываний последовательности задач с высоким риском. Развертывание с высоким риском автоматически устанавливается на клиенте и потенциально может привести к нежелательным результатам. Например, это последовательность задач с целью «Обязательно», которая выполняет развертывание операционной системы. Чтобы снизить риск нежелательного развертывания с высоким риском, можно настроить параметры проверки развертывания: Дополнительные сведения см. в разделе [Параметры для управления развертываниями с высоким риском](../../protect/understand/settings-to-manage-high-risk-deployments.md).  

-   **Сколько компьютеров могут одновременно получить образ операционной системы из одной точки распространения?**  

     Чтобы оценить необходимое число точек распространения, следует учесть скорость обработки и дискового ввода-вывода точки распространения, доступную пропускную способность сети и влияние размера пакета с образом на эти ресурсы. Например, в сети Ethernet со скоростью передачи данных 100 Мбит/с максимальное число компьютеров, способных обработать пакет с образом размером в 4 ГБ за один час, будет равно 11, если не учитывать другие серверные ресурсы.  

     `100 Megabits/sec = 12.5 Megabytes/sec = 750 Megabytes/min = 45 Gigabytes/hour = 11 images @ 4GB per image.`  

     Если нужно выполнить развертывание операционной системы на определенном числе компьютеров в течение заданного промежутка времени, образ следует распространить на достаточное количество точек распространения.  

-   **Можно ли развернуть образ операционной системы на точке распространения?**  

     Вы можете развернуть операционную систему на точке распространения, но этот образ операционной системы должен быть получен из другой точки распространения.  

###  <a name="BKMK_PXEDistributionPoint"></a> Настройка точек распространения для приема PXE-запросов  
 Чтобы развернуть операционные системы в клиентах Configuration Manager, отправляющих PXE-запросы загрузки, необходимо настроить одну или несколько точек распространения на прием PXE-запросов. После настройки точка распространения будет отвечать на PXE-запросы загрузки и сможет определить и предпринять нужные действия развертывания.

> [!IMPORTANT]  
>  [Службы развертывания Windows](../plan-design/infrastructure-requirements-for-operating-system-deployment.md#BKMK_WDS) необходимо установить на все точки распространения с поддержкой PXE.  

 Ниже приведена процедура внесения изменений в существующую точку распространения, позволяющих настроить прием PXE-запросов. Сведения об установке точки распространения см. в разделе [Установка или изменение точки распространения](../../core/servers/deploy/configure/install-and-configure-distribution-points.md).  

#### <a name="to-modify-an-existing-distribution-point-to-accept-pxe-requests"></a>Настройка существующей точки распространения для приема PXE-запросов  

1.  В консоли Configuration Manager щелкните **Администрирование**, разверните узел **Обзор** и щелкните **Точки распространения**.  

2.  Выберите точку распространения для настройки, а затем на вкладке **Главная** в группе **Свойства** нажмите кнопку **Свойства**.  

3.  На странице свойств точки распространения перейдите на вкладку **PXE** . и выберите **Включить поддержку PXE для клиентов** , чтобы включить PXE для этой точки распространения.  

4.  Щелкните **Да** в диалоговом окне **Информация о необходимых портах для протокола PXE** , чтобы подтвердить включение PXE. Configuration Manager автоматически настраивает порты по умолчанию в брандмауэре Windows. Если используется другой брандмауэр, необходимо настроить порты вручную.  

    > [!NOTE]  
    >  Если на том же сервере установлены службы развертывания Windows (WDS) и DHCP, необходимо настроить WDS на прослушивание другого порта (поскольку DHCP прослушивает тот же самый порт). Дополнительные сведения см. в разделе [Рекомендации при наличии WDS и DHCP на одном сервере](../plan-design/infrastructure-requirements-for-operating-system-deployment.md#BKMK_WDSandDHCP).  

5.  Установите флажок **Разрешить этой точке распространения отвечать на входящие PXE-запросы** для включения служб WDS таким образом, чтобы они отвечали на входящие PXE-запросы на обслуживание. Этот параметр служит для включения и отключения службы без удаления функций PXE из точки распространения.  

6.  Установите флажок **Включить поддержку неизвестных компьютеров**, чтобы развернуть операционные системы на компьютерах, для управления которыми не используется Configuration Manager.  

7.  Установите флажок **Требовать пароль при использовании компьютерами протокола PXE**, а затем укажите надежный пароль для обеспечения дополнительной защиты развертывания PXE.  

8.  In the **Сопоставление пользователей и устройств** укажите способ, которым точка распространения связывает пользователей с конечным компьютером для развертываний PXE.  

    -   Выберите **Не использовать сопоставление пользователей и устройств** , чтобы не связывать пользователей с конечным компьютером.  

    -   Выберите пункт **Разрешить сопоставление пользователей и устройств с утверждением вручную** , чтобы система дожидалась разрешения администратора, прежде чем связывать пользователей с конечным компьютером.  

    -   Выберите пункт **Разрешить сопоставление пользователей и устройств с автоматическим утверждением** , чтобы включить автоматическое связывание пользователей с конечным компьютером без ожидания утверждения.  

     Дополнительные сведения см. в разделе [Связывание пользователей с конечным компьютером](../get-started/associate-users-with-a-destination-computer.md).  

9. Укажите, будет ли точка распространения отвечать на PXE-запросы, получаемые от всех или только от конкретных сетевых интерфейсов. Если требуется, чтобы точка распространения отвечала на запросы определенных сетевых интерфейсов, укажите MAC-адреса всех таких интерфейсов.  

10. В случае использования нескольких точек распространения с поддержкой PXE укажите для точки распространения время задержки (в секундах) перед ответом на запросы компьютеров.  

11. Нажмите кнопку **ОК** , чтобы обновить свойства точки распространения.  

###  <a name="BKMK_RamDiskTFTP"></a> Настройка размеров блока и окна RamDisk TFTP в точках распространения с поддержкой PXE  
Вы можете настраивать размеры блока RamDisk TFTP, а начиная с версии Configuration Manager 1606 также и размеры окна для точек распространения с поддержкой PXE. Если изменить настройки сети, это может привести к тому, что при скачивании образа загрузки произойдет ошибка тайм-аута из-за слишком большого размера блока или окна. Настройка размеров блока и окна RamDisk TFTP позволяет оптимизировать трафик TFTP при использовании PXE для соответствия определенным требованиям сети.   
Чтобы определить наиболее эффективный вариант, необходимо протестировать измененные параметры в среде пользователя.  

-   **Размер блока TFTP**. Размер блока — это размер пакетов данных, отправляемых сервером клиенту, который загружает файл (как описано в RFC 2347). Больший размер блока позволяет серверу отправлять меньшее число пакетов, поэтому между сервером и клиентом возникает меньше задержек кругового пути. Однако, большие размеры блока приводят к фрагментации пакетов, которую не поддерживает большинство реализаций PXE-клиента.  

-   **Размер окна TFTP**. TFTP требуется пакет подтверждения (ACK) для каждого передаваемого блока данных. Сервер не отправляет следующий блок в последовательности, пока не получит пакет ACK для предыдущего блока. Изменение размера окна TFTP — это функция служб развертывания Windows, которая позволяет определять, сколько блоков данных необходимо для заполнения окна. Сервер отправляет блоки данных один за другим до заполнения окна, а затем клиент отправляет пакет ACK. Увеличение размера этого окна уменьшает число задержек кругового пути между клиентом и сервером, а также уменьшает общее время, необходимое для скачивания образа загрузки.  


#### <a name="to-modify-the-ramdisk-tftp-window-size"></a>Изменение размера окна RamDisk TFTP  

-   Чтобы настроить размер окна RamDisk TFTP, добавьте следующий раздел реестра в точках распространения с поддержкой PXE:  

     **Расположение**: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\SMS\DP  
    Имя: RamDiskTFTPWindowSize  

     **Тип**: REG_DWORD  

     **Значение**: &lt;измененный размер окна>  

 Значение по умолчанию — 1 (1 блок данных заполняет окно).  

#### <a name="to-modify-the-ramdisk-tftp-block-size"></a>Изменение размера блока RamDisk TFTP  

-   Чтобы настроить размер окна RamDisk TFTP, добавьте следующий раздел реестра в точках распространения с поддержкой PXE:  

     **Расположение**: HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\SMS\DP  
    Имя: RamDiskTFTPBlockSize  

     **Тип**: REG_DWORD  

     **Значение**: &lt;измененный размер блока>  

 Значение по умолчанию — 4096 (4 КБ).  


###  <a name="BKMK_DPMulticast"></a> Настройка точек распространения для поддержки многоадресной рассылки  
 Многоадресная рассылка — это метод оптимизации использования сети, который можно использовать для точек распространения, где высока вероятность того, что несколько клиентов будут одновременно скачивать один образ операционной системы. Когда используется многоадресная рассылка, несколько компьютеров могут одновременно скачивать образ операционной системы, рассылаемый точкой распространения. Этот механизм заменяет сценарий отправки точкой распространения копии данных на каждый клиентский компьютер через отдельное подключение. Для поддержки многоадресной рассылки необходимо настроить хотя бы одну точку распространения. Дополнительные сведения см. в разделе [Использование многоадресной рассылки для развертывания Windows по сети](../deploy-use/use-multicast-to-deploy-windows-over-the-network.md).  

 Перед развертыванием операционной системы необходимо настроить точку распространения и обеспечить поддержку многоадресной рассылки. Следующая процедура настраивает существующую точку распространения для работы с многоадресной рассылкой. Сведения об установке точки распространения см. в разделе [Установка и настройка точки распространения](../../core/servers/deploy/configure/install-and-configure-distribution-points.md).

#### <a name="to-enable-multicast-for-a-distribution-point"></a>Включение многоадресной рассылки для точки распространения  

1.  В консоли Configuration Manager щелкните **Администрирование**.  

2.  В рабочей области **Администрирование** разверните узел **Обзор**и выберите элемент **Точки распространения** .  

3.  Выберите точку распространения, которая будет использоваться при многоадресной рассылке образа операционной системы.  

4.  На вкладке **Главная** в группе **Свойства** нажмите кнопку **Свойства**.  

5.  Перейдите на вкладку **Многоадресная рассылка** и настройте следующие параметры:  

    -   **Включить многоадресную рассылку**. Выберите этот параметр, чтобы настроить точку распространения для работы с многоадресной рассылкой.  

    -   **Учетная запись многоадресной рассылки**. Укажите учетную запись для подключения к базе данных сайта.  

    -   **Параметры адреса многоадресной рассылки**. Укажите IP-адреса для отправки данных на конечные компьютеры. По умолчанию IP-адрес выдается с DHCP-сервера, который включен для распространения адресов многоадресной рассылки. В зависимости от сетевой среды можно указать IP-адреса в диапазоне от 239.0.0.0 до 239.255.255.255.  

        > [!IMPORTANT]  
        >  IP-адреса должны быть доступны для конечных компьютеров, запрашивающих образ операционной системы. Это значит, что маршрутизаторы и брандмауэры должны быть настроены для передачи трафика многоадресной рассылки между конечным компьютером и сервером сайта.  

    -   **Диапазон UDP-портов**. Укажите диапазон UDP-портов для отправки данных на конечные компьютеры.  

        > [!IMPORTANT]  
        >  UDP-порты должны быть доступны для конечных компьютеров, запрашивающих образ операционной системы. Это значит, что маршрутизаторы и брандмауэры должны быть настроены для передачи трафика многоадресной рассылки между конечным компьютером и сервером сайта.  

    -   **Активные запланированные многоадресные рассылки**. Укажите, каким образом Configuration Manager контролирует момент начала развертывания операционных систем на конечных компьютерах. Щелкните **Активные запланированные многоадресные рассылки**и выберите следующие параметры.  

         Укажите в поле **Задержка начала сеанса** задержку (в минутах), после которой Configuration Manager должен отвечать на первый запрос развертывания.  

         В поле **Минимальный размер сеанса** укажите, сколько запросов должно быть получено до запуска развертывания операционных систем диспетчером Configuration Manager.  

    -   **Скорость передачи**. Выберите скорость передачи данных на конечные компьютеры.  

    -   **Максимальное количество клиентов**. Укажите максимальное число конечных компьютеров, которые могут загрузить операционную систему из этой точки распространения.  

6.  Нажмите кнопку **ОК**.  

##  <a name="BKMK_StateMigrationPoints"></a> Точка миграции среды  
 Точка миграции состояния хранит данные пользовательской среды, собираемые на одном компьютере и затем восстанавливаемые на другом. Следует учитывать, что при сборе параметров пользователей для развертывания на одном компьютере (например при обновлении операционной системы на конечном компьютере) данные можно сохранить как на этом же компьютере с помощью жестких связей, так и в точке миграции состояния. В некоторых случаях (при создании в процессе развертывания хранилища состояний) Configuration Manager автоматически создает связь между хранилищем и конечным компьютером. При планировании реализации точки миграции состояния следует учитывать следующие факторы.  

### <a name="user-state-size"></a>Размер данных пользовательской среды  
 Размер данных пользовательской среды оказывает самое непосредственное влияние на дисковое пространство, используемое на точке миграции состояния, и нагрузку на сеть при миграции. Следует учесть размер данных пользовательской среды и число обрабатываемых компьютеров. Следует также решить, что именно будет переноситься с компьютеров в ходе миграции. Например, если резервная копия папки **Мои документы** уже создана на сервере, то скорее всего ее не потребуется переносить в ходе развертывания образа. Исключение из процесса ненужных операций будет способствовать уменьшению общего размера данных пользовательской среды и снижению его влияния на ресурсы сети и дисковое пространство на точке миграции состояния.  

### <a name="user-state-migration-tool"></a>Средство миграции пользовательской среды  
 Для сбора данных пользовательской среды и их восстановления в ходе развертывания операционных систем необходимо использовать пакет средства миграции пользовательской среды (USMT), указывающий на исходные файлы этого средства. Configuration Manager автоматически создает этот пакет в консоли Configuration Manager в области **Библиотека программного обеспечения** > **Управление приложениями** > **Пакеты**. Configuration Manager использует средство USMT 10.0, которое распространяется в составе комплекта средств для развертывания и оценки Windows (Windows ADK), для сбора сведений о пользовательской среде из одной ОС и восстановления в другой.  

 Различные сценарии миграции для USMT 10.0 рассмотрены в статье [Распространенные сценарии миграции](https://technet.microsoft.com/library/mt299169\(v=vs.85\).aspx).  

### <a name="retention-policy"></a>Политика хранения  
 При настройке точки миграции состояния можно указать период времени, в течение которого следует сохранять данные пользовательской среды, хранимые в ней. Длительность этого периода будет зависеть от двух факторов:  

-   Влияния хранимых данных на дисковое пространство.  

-   Требований, связанных с возможной повторной миграцией этих же данных.  

 Миграция состояния состоит из двух этапов: сбора данных и их восстановления. В ходе сбора данные пользовательской среды сохраняются в точке миграции состояния. При восстановлении данные пользовательской среды извлекаются из точки миграции состояния, записываются на конечный компьютер и затем "освобождаются" шагом **Освободить хранилище состояний** последовательности задач. После "освобождения" данных запускается таймер хранения. Если было указано немедленно удалять данные, успешно обработанные процессом миграции, такие данные пользовательской среды будут удаляться сразу же после "освобождения". Если же было указано хранить данные в течение определенного периода времени, данные будут удаляться по истечение этого периода (его началом считается "освобождение" данных пользовательской среды). Чем дольше период хранения, тем больше дискового пространства может потребоваться на его обслуживание.  

### <a name="select-drive-to-store-user-state-migration-data"></a>Выбор диска для хранения данных миграции пользовательской среды  
 При настройке точки миграции состояния необходимо выбрать диск на сервере, на котором будут храниться переносимые данные пользовательской среды. Выбор осуществляется из фиксированного списка дисков. Следует учитывать, что в список могут входить и устройства, не поддерживающие запись (например, дисковод компакт-дисков), или диски, не являющиеся общими (подключенными к сети). Некоторые буквы дисков могут быть вообще не связаны с какими бы то ни было дисками или устройствами на компьютере. Для точки миграции состояния должен быть указан общий диск, поддерживающий запись.  

### <a name="configure-a-state-migration-point"></a>Настройка точки миграции состояния  
 Ниже приведены способы настройки точки миграции состояния для хранения данных пользовательской среды:  

-   создание нового сервера системы сайта для точки миграции состояния с помощью **мастера создания сервера системы сайта** ;  

-   добавление точки миграции среды на существующий сервер с помощью **мастера добавления ролей системы сайта** .  

 При использовании этих мастеров потребуется указать для точки миграции состояния следующие сведения:  

-   папки для хранения данных пользовательской среды;  

-   максимальное число клиентов, которые могут сохранять данные на точке миграции состояния;  

-   минимальный объем свободного пространства для хранения данных пользовательской среды на точке миграции состояния;  

-   политику удаления для роли (можно задать немедленное удаление данных пользовательской среды после восстановления на компьютере или указать интервал удаления (в днях) после восстановления данных пользователя на компьютере);  

-   будет ли точка миграции состояния отвечать только на запросы восстановления данных о пользовательской среде. Если выбрать этот вариант, точку миграции состояния нельзя будет использовать для сохранения данных пользовательской среды.  

 Инструкции по установке роли системы сайта см. в разделе [Добавление ролей системы сайта](../../core/servers/deploy/configure/add-site-system-roles.md).  
