---
title: "Подготовка однорангового кэша среды предустановки Windows для снижения трафика глобальной сети | Документы Майкрософт"
description: "Одноранговый кэш Windows PE работает в среде предустановки Windows для получения содержимого из локального однорангового узла и уменьшения объема трафика глобальной сети при отсутствии локальной точки распространения."
ms.custom: na
ms.date: 10/06/2016
ms.prod: configuration-manager
ms.reviewer: na
ms.suite: na
ms.technology: configmgr-osd
ms.tgt_pltfrm: na
ms.topic: get-started-article
ms.assetid: 6c64f276-b88c-4b1e-8073-331876a03038
caps.latest.revision: "11"
author: Dougeby
ms.author: dougeby
manager: angrobe
ms.openlocfilehash: 814c6133a30b1116d05aaeafddb0dfb7fe2a390e
ms.sourcegitcommit: 51fc48fb023f1e8d995c6c4eacfda7dbec4d0b2f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2017
---
# <a name="prepare-windows-pe-peer-cache-to-reduce-wan-traffic-in-system-center-configuration-manager"></a>Подготовка однорангового кэша Windows PE для снижения трафика глобальной сети в System Center Configuration Manager

*Применимо к: System Center Configuration Manager (Current Branch)*

При развертывании новой операционной системы в System Center Configuration Manager компьютеры, на которых выполняется последовательность задач, могут использовать одноранговый кэш среды предустановки Windows для получения содержимого из локального узла (источника однорангового кэша) вместо скачивания содержимого из точки распространения. Это позволяет уменьшить объем трафика глобальной сети (WAN) в сценариях с филиалами, где локальные точки распространения отсутствуют.  

 Одноранговый кэш Windows PE похож на [Windows BranchCache](http://technet.microsoft.com/library/mt617255\(TechNet.10\).aspx#bkmk_branchcache), но функционирует в среде предустановки Windows (Windows PE). В случае запуска последовательности задач из контекста операционной системы, например из центра программного обеспечения на клиенте, одноранговый кэш Windows PE не используется. Для описания клиентов, использующих одноранговый кэш Windows PE, применяются следующие термины:  

-   **Клиент однорангового кэша** — это компьютер, настроенный на использование однорангового кэша Windows PE.  

-   **Источник однорангового кэша** — это клиент, настроенный для однорангового кэша, который делает содержимое доступным для других клиентов однорангового кэша, запрашивающих данное содержимое.  

Ниже приведены процедуры управления одноранговым кэшем.

##  <a name="BKMK_PeerCacheObjects"></a> Объекты, хранящиеся в источнике однорангового кэша  
 Последовательность задач, настроенная на использование однорангового кэша Windows PE, может получить следующие объекты содержимого во время выполнения в Windows PE:  

-   Образ операционной системы  

-   Пакет драйвера  

-   Пакеты и программы (когда клиент продолжает выполнять последовательность задач в полной операционной системе, он получает это содержимое из источника однорангового кэша, если последовательность задач была изначально настроена для однорангового кэша при работе в среде Windows PE).  

-   Дополнительные загрузочные образы.  

 Следующие объекты содержимого никогда не передаются с помощью однорангового кэша. Вместо этого они передаются из точки распространения или кэшем Windows BranchCache, если Windows BranchCache настроен в вашей среде.  

-   Приложения  

-   Обновления программного обеспечения  

##  <a name="BKMK_PeerCacheWork"></a> Принцип работы однорангового кэша Windows PE  
 Рассмотрим ситуацию с филиалом, где нет точки распространения, но имеются несколько клиентов, которые могут использовать одноранговый кэш Windows PE. Последовательность задач, настроенная на использование однорангового кэша, развертывается на нескольких клиентах, которые включены в состав источника однорангового кэша. Первый клиент, предназначенный для выполнения последовательности задач, осуществляет вещание запроса на одноранговый узел с содержимым. Он не находит его и получает содержимое из точки распространения по глобальной сети. Клиент устанавливает новый образ, а затем сохраняет содержимое в своем кэше клиента Configuration Manager, поэтому он может работать как источник однорангового кэша для других клиентов. Когда следующий клиент выполняет последовательность задач, он осуществляет вещание запроса в подсети на источник однорангового кэша, первый клиент отвечает и делает доступным свое кэшированное содержимое.  

##  <a name="BKMK_PeerCacheDetermine"></a> Определение клиентов, входящих в состав источника однорангового кэша Windows PE  
 Чтобы помочь вам определить, какие компьютеры следует выбрать в качестве источника однорангового кэша Windows PE, отметим несколько вещей, которые следует учитывать:  

-   Источником однорангового кэша Windows PE должен быть настольный компьютер, который всегда включен и доступен для клиентов однорангового кэша.  

-   Одноранговый кэш Windows PE должен иметь размер кэша клиента достаточного размера для хранения образов.  

##  <a name="BKMK_PeerCacheRequirements"></a> Требования к клиенту для использования источника однорангового кэша Windows PE  
 Чтобы использовать источник однорангового кэша Windows PE, клиенты должны соответствовать следующим требованиям:  

-   Клиент Configuration Manager должен быть способен взаимодействовать через следующие порты в сети:  

    -   Порт для начального вещания по сети для нахождения источника однорангового кэша. По умолчанию используется порт 8004.  

    -   Порт для скачивания содержимого из источника однорангового кэша (HTTP и HTTPS). По умолчанию используется порт 8003.  

        > [!TIP]  
        >  Клиенты будут использовать HTTPS для скачивания содержимого, если оно доступно. Однако и для HTTP, и для HTTPS используется один и тот же номер порта.  

-   [Настройте кэш клиента для клиентов Configuration Manager](../../core/clients/manage/manage-clients.md#BKMK_ClientCache), чтобы обеспечить наличие на них достаточного места для удержания и хранения развертываемых образов. Одноранговый кэш Windows PE не влияет на конфигурацию или поведение кэша клиента.  

-   В параметрах развертывания для развертывания последовательности задач должна быть настроена возможность локального скачивания содержимого в случаях, когда это требуется для последовательности задач.  

##  <a name="BKMK_PeerCacheConfigure"></a> Настройка однорангового кэша Windows PE  
 Вы можете применять следующие методы для предоставления клиенту содержимого однорангового кэша, чтобы он мог служить источником однорангового кэша.  

-   Клиент однорангового кэша, который не может найти источник однорангового кэша с содержимым, загрузит его из точки распространения.  Если клиент получает параметры клиента, разрешающие одноранговый кэш, и последовательность задач настроена на сохранение кэшированного содержимого, данный клиент становится источником однорангового кэша.  

-   Клиент однорангового кэша может получать содержимое от другого клиента однорангового кэша (источника однорангового кэша).  Так как клиент настроен для однорангового кэша, когда он запускает последовательность задач, настроенную на сохранение кэшированного содержимого, сам клиент становится источником однорангового кэша.  

-   Клиент запускает последовательность задач, включающую в себя дополнительный шаг — [Загрузить содержимое пакета](../understand/task-sequence-steps.md#BKMK_DownloadPackageContent). Этот шаг используется для предварительной подготовки соответствующего содержимого, включенного в последовательность задач однорангового кэша Windows PE. При использовании этого метода  

    -   Клиенту не требуется устанавливать развертываемый образ.  

    -   Помимо параметра **Скачать содержимое пакета** , последовательность задач также должна использовать параметр **Кэш клиента Configuration Manager** . Этот параметр следует использовать для хранения содержимого в кэше клиентов, чтобы клиент мог работать в качестве источника однорангового кэша для других клиентов однорангового кэша.  

 С помощью следующих процедур можно настроить одноранговый кэш Windows PE на клиентах и настроить последовательности задач, которые поддерживают одноранговый кэш.  

### <a name="to-configure-the-windows-pe-peer-cache-source-computers"></a>Настройка компьютеров источника однорангового кэша Windows PE  

1.  В консоли Configuration Manager выберите **Администрирование** > **Параметры клиента**, а затем создайте **настраиваемые параметры клиентского устройства** или измените существующий объект параметров. Это можно также настроить для объекта **параметров клиента по умолчанию** .  

    > [!TIP]  
    >  Используйте объект настраиваемых параметров для выбора клиентов, которые получат эту конфигурацию. Например, такая конфигурация может оказаться нецелесообразной для ноутбуков пользователей, которые часто находятся в пути. Чрезвычайно мобильная система вряд ли будет хорошим источником для предоставления содержимого другим клиентам однорангового кэша.  
    >   
    >  Также следует помнить, что при настройке этого параметра в составе **параметров клиента по умолчанию**конфигурация применяется ко всем клиентам в вашей среде.  

2.  В разделе **Одноранговый кэш Windows PE**для параметра **Включить клиент Configuration Manager в полной ОС для общего доступа к содержимому** установите значение **Да**.  

    -   По умолчанию включен только HTTP. Если нужно разрешить клиентам загружать содержимое по протоколу HTTPS, для параметра **Включить HTTPS для одноранговой связи с клиентами** установите значение **Да**.  

    -   По умолчанию для порта для вещания установлено значение 8004, а для порта для загрузки содержимого — 8003. Оба эти значения можно изменить.  

3.  Сохраните и разверните параметры клиента для клиентов, выбранных в качестве источника однорангового кэша.  

 После настройки устройства с этим объектом параметров данное устройство будет работать как источник однорангового кэша. Эти параметры следует развернуть на потенциальных клиентах однорангового кэша для настройки требуемых портов и протоколов.  

###  <a name="BKMK_PeerCacheConfigureTS"></a> Настройка последовательности задач для однорангового кэша Windows PE  
 При настройке последовательности задач используйте следующие переменные последовательности задач как переменные коллекции, для которой выполняется развертывание последовательности задач:  

-   **SMSTSPeerDownload**  

     Значение: TRUE.  

     Это позволяет клиенту использовать одноранговый кэш Windows PE.  

-   **SMSTSPeerRequestPort**  

     Значение: <номер порта\>  

     Если не используется порт по умолчанию, настроенный в параметрах клиента (8004), для этой переменной необходимо указать пользовательское значение сетевого порта, который будет применяться для начального вещания.  

-   **SMSTSPreserveContent**  

     Значение: TRUE.  

     Указывает, что содержимое в последовательности задач должно храниться в кэше клиента Configuration Manager после развертывания. Это отличается от случая с применением переменной SMSTSPersistContent, которая сохраняет содержимое лишь на время выполнения последовательности задач и использует кэш последовательности задач, а не кэш клиента Configuration Manager.  

 Дополнительные сведения см. в разделе [Встроенные переменные последовательности задач](../understand/task-sequence-built-in-variables.md).  

###  <a name="BKMK_PeerCacheValidate"></a> Проверка успешного применения однорангового кэша Windows PE  
 После использования однорангового кэша Windows PE для развертывания и установки последовательности задач можно убедиться в успешном применении однорангового кэша, просмотрев **smsts.log** на клиенте, который запустил последовательность задач.  

 В журнале найдите запись, подобную показанной ниже, где <*SourceServerName*> определяет компьютер, с которого клиент получил содержимое. Этот компьютер должен быть источником однорангового кэша, а не сервером точки распространения. Другие данные будут зависеть от вашей локальной среды и конфигурации.  

-   *<![LOG[Downloaded file from http:// <SourceServerName\>:8003/SCCM_BranchCache$/SS10000C/sccm?/install.wim to C:\\_SMSTaskSequence\Packages\SS10000C\install.wim ]LOG]!><time="14:24:33.329+420" date="06-26-2015" component="ApplyOperatingSystem" context="" type="1" thread="1256" file="downloadcontent.cpp:1626">*  
