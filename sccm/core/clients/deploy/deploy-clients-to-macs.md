---
title: "Развертывание клиентов Mac | Документы Майкрософт"
description: "Сведения о развертывании клиентов на компьютерах Mac в System Center Configuration Manager."
ms.custom: na
ms.date: 05/04/2017
ms.prod: configuration-manager
ms.reviewer: aaroncz
ms.suite: na
ms.technology: configmgr-client
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: e46ad501-5d73-44ac-92de-0de14ef72b83
caps.latest.revision: "12"
author: robstackmsft
ms.author: robstack
manager: angrobe
ms.openlocfilehash: 6ce212c6745b70a47553891e5dbc124b4c4e50fa
ms.sourcegitcommit: 51fc48fb023f1e8d995c6c4eacfda7dbec4d0b2f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2017
---
# <a name="how-to-deploy-clients-to-macs"></a>How to deploy clients to Macs

*Применимо к: System Center Configuration Manager (Current Branch)*

В этом разделе описывается развертывание и обслуживание клиента Configuration Manager на компьютерах Mac. Сведения о том, что нужно настроить перед развертыванием клиентов на компьютерах Mac, см. в разделе [Подготовка к развертыванию клиентского программного обеспечения на компьютерах Mac](/sccm/core/clients/deploy/prepare-to-deploy-mac-clients).

При установке нового клиента для компьютеров Mac необходимо также установить обновления Configuration Manager, чтобы вывести новые сведения о клиенте в консоли Configuration Manager.

В этих процедурах у вас есть два варианта установки сертификатов клиента. Дополнительные сведения о сертификатах клиента для Mac см. в разделе [Подготовка к развертыванию клиентского программного обеспечения на компьютерах Mac](/sccm/core/clients/deploy/prepare-to-deploy-mac-clients#certificate-requirements).  

-   Регистрация в Configuration Manager с помощью [средства CMEnroll](#install-the-client-and-then-enroll-the-client-certificate-on-the-mac). Процесс регистрации не поддерживает автоматическое продление сертификата, поэтому необходимо повторно регистрировать компьютеры Mac до истечения срока действия установленного сертификата.    

-   [Использование метода запроса и установки сертификата, который не зависит от Configuration Manager](#use-a-certificate-request-and-installation-method-that-is-independent-from-configuration-manager). 

>[!IMPORTANT]
>  Для развертывания клиента на устройствах под управлением macOS Sierra необходимо правильно настроить имя субъекта в сертификате точки управления (например, указав полное доменное имя сервера точки управления).


## <a name="configure-client-settings-for-enrollment"></a>Настройка параметров клиента для регистрации  
 Чтобы настроить регистрацию для компьютеров Mac, необходимо использовать [параметры клиента по умолчанию](../../../core/clients/deploy/about-client-settings.md). Использовать настраиваемые параметры клиента нельзя.  

 Это действие требуется, чтобы Configuration Manager мог запрашивать и устанавливать сертификат на компьютере Mac.  

### <a name="to-configure-the-default-client-settings-for-configuration-manager-to-enroll-certificates-for-macs"></a>Настройка параметров клиента по умолчанию, чтобы Configuration Manager мог регистрировать сертификаты для компьютеров Mac  

1.  В консоли Configuration Manager последовательно выберите **Администрирование** >  **Параметры клиента** > **Параметры клиента по умолчанию**.  

4.  На вкладке **Главная** в группе **Свойства** нажмите кнопку **Свойства**.  

5.  Выберите раздел **Регистрация**, а затем настройте указанные ниже параметры.  

    1.  **Разрешить пользователям регистрировать мобильные устройства и компьютеры Mac: да**  

    2.  **Профиль регистрации**: нажмите кнопку **Задать профиль**.  

6.  В диалоговом окне **Профиль регистрации мобильных устройств** нажмите кнопку **Создать**.  

7.  В диалоговом окне **Создание профиля регистрации** введите имя этого профиля регистрации, а затем настройте **код сайта управления**. Выберите первичный сайт Configuration Manager, который содержит точки управления для управления компьютерами Mac.  

    > [!NOTE]  
    >  Если сайт выбрать не удается, проверьте, что хотя бы одна точка управления на сайте настроена для поддержки мобильных устройств.  

8.  Нажмите кнопку **Добавить**.  

9. В диалоговом окне **Добавление центра сертификации для мобильных устройств** выберите сервер центра сертификации (ЦС), который будет выдавать сертификаты компьютерам Mac.  

10. В диалоговом окне **Создание профиля регистрации** выберите шаблон сертификата для компьютера Mac, созданный в действии 3.  

11. Нажмите кнопку **ОК**, чтобы закрыть диалоговое окно **Профиль регистрации**, а затем — диалоговое окно **Параметры клиента по умолчанию**.  

    > [!TIP]  
    >  Если требуется изменить интервал политики клиента, используйте параметр **Интервал опроса политики клиента** в группе параметров клиента **Политика клиента**.  

 Все пользователи будут настроены с использованием этих параметров при следующем скачивании клиентской политики. Сведения об инициации получения политики для отдельного клиента см. в статье [Инициация получения политик для клиента Configuration Manager](../../../core/clients/manage/manage-clients.md#BKMK_PolicyRetrieval).  

 Помимо параметров регистрации клиента, убедитесь в том, что настроены следующие параметры клиентских устройств:  

-   **Инвентаризация оборудования**: включите и настройте этот параметр, если планируется собирать данные инвентаризации оборудования с клиентских компьютеров Mac и Windows. Дополнительные сведения см. в статье [Расширение инвентаризации оборудования в System Center Configuration Manager](../../../core/clients/manage/inventory/extend-hardware-inventory.md).  

-   **Параметры соответствия**: включите и настройте этот параметр, если планируется оценивать и исправлять параметры на клиентских компьютерах Mac и Windows. Дополнительные сведения см. в статье [Планирование и настройка параметров соответствия](../../../compliance/plan-design/plan-for-and-configure-compliance-settings.md).  

> [!NOTE]  
>  Дополнительные сведения о параметрах клиентов Configuration Manager см. в статье [Настройка параметров клиента в System Center Configuration Manager](../../../core/clients/deploy/configure-client-settings.md).  

## <a name="download-the-client-source-files-for-macs"></a>Скачивание исходных файлов клиента для компьютеров Mac  

1.  Загрузите пакет файлов клиента Mac OS X (файл **ConfigmgrMacClient.msi**) и сохраните его на компьютере под управлением Windows.  

     Этот файл отсутствует на установочном носителе Configuration Manager. Его можно загрузить в [Центре загрузки Майкрософт](http://go.microsoft.com/fwlink/?LinkID=525184).  

2.  На компьютере с ОС Windows запустите файл **ConfigmgrMacClient.msi**, чтобы извлечь пакет клиента Mac с именем Macclient.dmg в папку на локальном диске (по умолчанию это папка **C:\Program Files (x86)\Microsoft\System Center 2012 Configuration Manager Mac Client\\**).  

3.  Скопируйте файл Macclient.dmg в папку на компьютере Mac.  

4.  На компьютере Mac запустите файл Macclient.dmg, чтобы извлечь его файлы в папку на локальном диске.  

5.  В этой папке убедитесь, что извлечены файлы Ccmsetup и CMClient.pkg, и что создана папка с именем Tools, содержащая средства CMDiagnostics,  CMUninstall, CMAppUtil и CMEnroll.

    -  **Ccmsetup**: устанавливает клиент Configuration Manager на компьютерах Mac.  

    -   **CMDiagnostics**: собирает диагностические сведения, относящиеся к клиенту Configuration Manager, на компьютерах Mac.  

    -   **CMUninstall**: удаляет клиент с компьютеров Mac.  

    -   **CMAppUtil**: преобразует пакеты приложений Apple в формат, который может быть развернут как приложение Configuration Manager.  

    -   **CMEnroll**: запрашивает и устанавливает сертификат клиента на компьютере Mac, на котором затем можно будет установить клиент Configuration Manager.   

## <a name="install-the-client-and-then-enroll-the-client-certificate-on-the-mac"></a>Установка клиента и регистрация сертификата клиента на компьютере Mac  

Вы можете зарегистрировать отдельные клиенты с помощью [мастера регистрации компьютеров Mac](#enroll-the-client-with-the-mac-computer-enrollment-wizard).

Для автоматической регистрации большого числа клиентов используйте [средство CMEnroll](#client-and-certificate-automation-with-cmenroll).   


###  <a name="enroll-the-client-with-the-mac-computer-enrollment-wizard"></a>Регистрация клиента с помощью мастера регистрации компьютеров Mac  

1.  После завершения установки клиента откроется мастер регистрации компьютеров. Если мастер не откроется или вы его случайно закроете, нажмите кнопку **Зарегистрировать** на странице настроек **Configuration Manager**, чтобы открыть мастер.  

2.  На второй странице мастера укажите приведенные ниже сведения.  

    -   **Имя пользователя** — имя пользователя может быть задано в следующих форматах:  

        -   'домен\имя’. Например: 'contoso\mnorth'  

        -   "user@domain". Пример: "mnorth@contoso.com"  

            > [!IMPORTANT]  
            >  В случае указания адреса электронной почты при заполнении поля **Имя пользователя** Configuration Manager автоматически использует доменное имя адреса электронной почты и имя по умолчанию сервера прокси-точки регистрации для заполнения поля **Имя сервера**. Если доменное имя и имя сервера не соответствуют имени сервера прокси-точки регистрации, сообщите пользователям правильное имя, чтобы они могли ввести его при регистрации своих компьютеров Mac.  

         Имя пользователя и пароль должны соответствовать учетной записи пользователя Active Directory, которой предоставлены разрешения на чтение и запись в шаблоне сертификата клиента Mac.  

    -   **Пароль** — введите пароль, соответствующий указанному имени пользователя.  

    -   **Имя сервера** — введите имя сервера прокси-точки регистрации.  


### <a name="client-and-certificate-automation-with-cmenroll"></a>Автоматизация операций с клиентом и сертификатами с помощью CMEnroll  

Эта процедура позволяет автоматизировать установку клиента и запрос регистрации сертификатов клиента с помощью средства CMEnroll. Для запуска средства требуется учетная запись пользователя Active Directory.

1.  На компьютере Mac перейдите в папку, в которую было извлечено содержимое файла Macclient.dmg.  

2.  Введите следующую команду: **sudo ./ccmsetup**.  

3.  Подождите, пока не появится сообщение **Установка завершена** . Хотя установщик выводит сообщение о необходимости перезагрузки компьютера, не выполняйте перезагрузку, а перейдите к следующему действию.  

4.  Из папки Tools на компьютере Mac введите следующую команду: **sudo ./CMEnroll -s &lt;имя_прокси-сервера_регистрации> -ignorecertchainvalidation -u &lt;имя_пользователя'>**  

    После установки клиента откроется мастер регистрации компьютеров Mac, служащий для упрощения этой процедуры. Чтобы зарегистрировать клиент с помощью данного метода, см. раздел [To enroll the client by using the Mac Computer Enrollment Wizard](#BKMK_EnrollR2) этой статьи.  

5. Введите пароль для учетной записи пользователя Active Directory.  При вводе этой команды запрашивается два пароля: первый запрос — для учетной записи суперпользователя, которая необходима для выполнения команды. Второй запрос — для учетной записи пользователя Active Directory. Запросы выглядят одинаково, поэтому убедитесь в правильной последовательности ответов на них.  

    Имя пользователя может быть задано в следующих форматах:  

    -   'домен\имя’. Например: 'contoso\mnorth'  

    -   "user@domain". Пример: "mnorth@contoso.com"  

     Имя пользователя и пароль должны соответствовать учетной записи пользователя Active Directory, которой предоставлены разрешения на чтение и запись в шаблоне сертификата клиента Mac.  

     Пример. Если сервер прокси-точки регистрации называется **server02.contoso.com**, а имя пользователя **contoso\mnorth** имеет разрешения для шаблона сертификата клиента Mac, введите следующую команду: **sudo ./CMEnroll -s server02.contoso.com -ignorecertchainvalidation -u 'contoso\mnorth'**  

    > [!NOTE]  
    >  При наличии в имени пользователя символов **&lt;>"+=,** регистрация завершается с ошибкой. Получите сертификат аппаратного контроллера управления с именем пользователя, которое не содержит такие символы.  
    >  
    >  Для обеспечения более удобного пользовательского взаимодействия можно создать скрипт, включающий действия и команды по установке, чтобы пользователям было достаточно просто указать свои имена пользователей и пароли.  

5.  Подождите, пока не появится сообщение **Регистрация выполнена успешно** .  

6.  Чтобы ограничить зарегистрированный сертификат рамками Configuration Manager, на компьютере Mac откройте окно терминала и внесите указанные ниже изменения.  

    a.  Введите команду **sudo /Applications/Utilities/Keychain\ Access.app/Contents/MacOS/Keychain\ Access**  

    б.  В диалоговом окне **Доступ к цепочке ключей** в области **Цепочки ключей** выберите **Система**, а затем в разделе **Категория** выберите **Ключи**.  

    в.  Разверните ключи для просмотра сертификатов клиента. Найдите сертификат с только что установленным закрытым ключом и дважды щелкните ключ.  

    г.  На вкладке **Управление доступом** выберите пункт **Подтвердить перед предоставлением доступа**.  

    д.  Перейдите в папку **/Library/Application Support/Microsoft/CCM**, выберите файл **CCMClient** и нажмите кнопку **Добавить**.  

    е.  Нажмите кнопку **Сохранить изменения** и закройте диалоговое окно **Доступ к цепочке ключей**.  

7.  Перезапустите компьютер Mac.  

 Убедитесь, что клиент успешно установлен, открыв элемент **Configuration Manager** в **системных настройках** на компьютере Mac. Кроме того, можно обновить и просмотреть коллекцию **Все системы** , чтобы убедиться, что компьютер Mac теперь отображается в этой коллекции как управляемый клиент.  

> [!TIP]  
>  Для устранения неполадок клиента Mac можно использовать программу CMDiagnostics, которая включена в пакет клиента Mac OS X и собирает указанные ниже диагностические сведения.  
>   
>  -   Список запущенных процессов.  
> -   Версия операционной системы Mac OS X  
> -   Отчеты о сбоях Mac OS X, касающиеся клиента Configuration Manager, в том числе **CCM\*.crash** и **System Preference.crash**.  
> -   BOM-файл и файл списка свойств (PLIST), созданные установкой клиента Configuration Manager.  
> -   Содержимое папки /Library/Application Support/Microsoft/CCM/Logs.  
>   
>  Сведения, собранные программой CmDiagnostics, добавляются в ZIP-файл, который сохраняется на рабочем столе компьютера с именем cmdiag-*<имя узла\>***-***&gt;<дата и время\>*.zip.***


##  <a name="use-a-certificate-request-and-installation-method-that-is-independent-from-configuration-manager"></a>Использовать запрос сертификата и способ установки, независимые от Configuration Manager  

Сначала выполните следующие задачи, описываемые в разделе [Подготовка к развертыванию клиентского программного обеспечения на компьютерах Mac](/sccm/core/clients/deploy/prepare-to-deploy-mac-clients):

1. [Развертывание сертификата веб-сервера на серверах системы сайта](/sccm/core/clients/deploy/prepare-to-deploy-mac-clients#deploy-a-web-server-certificate-to-site-system-servers)

2. [Развертывание сертификата проверки подлинности клиента на серверах системы сайта](/sccm/core/clients/deploy/prepare-to-deploy-mac-clients#deploy-a-client-authentication-certificate-to-site-system-servers)

3. [Настройка точки управления и точки распространения](/sccm/core/clients/deploy/prepare-to-deploy-mac-clients#configure-the-management-point-and-distribution-point)

4. [Необязательно: установка точки служб отчетов](/sccm/core/clients/deploy/prepare-to-deploy-mac-clients#install-the-reporting-services-point)

Затем выполните следующие задачи:

5. [Скачивание исходных файлов клиента для компьютеров Mac](#download-the-client-source-files-for-macs).  
6. Используйте инструкции для выбранного способа развертывания сертификата, чтобы запросить и установить сертификат клиента на компьютер Mac.  
7.  Перейдите в папку, в которую было извлечено содержимое файла macclient.dmg, загруженного из Центра загрузки Майкрософт.  

3.  Введите следующую команду: **sudo ./ccmsetup -MP <полное доменное имя точки управления в Интернете\> -SubjectName <значение субъекта сертификата\>**.  Значение субъекта сертификата вводится с учетом регистра. Вводите его в точности так, как оно отображается в окне сведений сертификата.  

     Пример. Если в свойствах системы сайта указано полное доменное имя в Интернете **server03.contoso.com**, а клиентский сертификат для Mac имеет полное доменное имя **mac12.contoso.com** в качестве общего имени в субъекте сертификата, введите **sudo ./ccmsetup -MP server03.contoso.com -SubjectName mac12.contoso.com**.  

4.  Дождитесь появления сообщения **Установка завершена** , затем перезапустите компьютер Mac.  

5.  Чтобы убедиться в доступности этого сертификата для Configuration Manager, на компьютере Mac откройте окно терминала и внесите указанные ниже изменения.  

    a.  Введите команду **sudo /Applications/Utilities/Keychain\ Access.app/Contents/MacOS/Keychain\ Access**  

    б.  В диалоговом окне **Доступ к цепочке ключей** в области **Цепочки ключей** выберите **Система**, а затем в разделе **Категория** выберите **Ключи**.  

    в.  Разверните ключи для просмотра сертификатов клиента. Найдите сертификат с только что установленным закрытым ключом и дважды щелкните ключ.  

    г.  На вкладке **Управление доступом** выберите пункт **Подтвердить перед предоставлением доступа**.  

    д.  Перейдите в папку **/Library/Application Support/Microsoft/CCM**, выберите файл **CCMClient** и нажмите кнопку **Добавить**.  

    е.  Нажмите кнопку **Сохранить изменения** и закройте диалоговое окно **Доступ к цепочке ключей**.  

6.  Если у вас есть несколько сертификатов, содержащих одно и то же значение субъекта, необходимо указать серийный номер сертификата, который предполагается использовать для клиента Configuration Manager. Для этого используйте следующую команду: **sudo defaults write com.microsoft.ccmclient SerialNumber -data "<серийный номер\>"**.  

     Например: **sudo defaults write com.microsoft.ccmclient SerialNumber -data "17D4391A00000003DB"**.  

 Убедитесь в том, что клиент успешно установлен, открыв элемент **Configuration Manager** в **системных настройках** на компьютере Mac. Кроме того, можно обновить и просмотреть коллекцию **Все системы**, чтобы убедиться в том, что компьютер Mac отображается в этой коллекции как управляемый клиент.  

## <a name="renewing-the-mac-client-certificate"></a>Продление сертификата клиента для Mac  
 Используйте следующую процедуру перед продлением сертификата компьютера на компьютерах Mac.  

 Эта процедура удаляет SMSID, необходимый клиенту для использования нового или продленного сертификата на компьютере Mac.  

> [!IMPORTANT]  
>  При удалении и замене SMSID клиента все сохраненные журналы клиента, такие как инвентарные данные, удаляются после удаления клиента из консоли Configuration Manager.  

### <a name="to-renew-the-mac-client-certificate"></a>Продление сертификата клиента для Mac  

1.  Создайте и заполните коллекцию устройств для компьютеров Mac, на которых требуется обновить сертификаты компьютеров.  

2.  В рабочей области **Активы и соответствие** выберите **Запуск мастера создания элементов конфигурации**.  

3.  На странице **Общие** мастера укажите следующие данные.  

    -   **Имя:удалить SMSID для Mac**  

    -   **Тип:Mac OS X**  

4.  На странице мастера **Поддерживаемые платформы** убедитесь, что выбраны все версии Mac OS X.  

5.  На странице **Параметры** мастера щелкните **Создать** , а затем в диалоговом окне **Создание параметра** укажите следующие сведения.  

    -   **Имя:удалить SMSID для Mac**  

    -   **Тип параметра:сценарий**  

    -   **Тип данных:строковый**  

6.  В диалоговом окне **Создание параметра** в области **Сценарий обнаружения**щелкните **Добавить сценарий** , чтобы указать сценарий для обнаружения компьютеров Mac с настроенным SMSID.  

7.  В диалоговом окне **Изменение сценария обнаружения** введите следующий сценарий:  

    ```  
    defaults read com.microsoft.ccmclient SMSID  
    ```  

8.  Нажмите кнопку **ОК**, чтобы закрыть диалоговое окно **Изменение сценария обнаружения**.  

9. В диалоговом окне **Создание параметра** в области **Сценарий исправления (необязательно)** выберите команду **Добавить сценарий**, чтобы указать сценарий, который удаляет SMSID при его обнаружении на компьютерах Mac.  

10. В диалоговом окне **Создание сценария исправления** введите следующий сценарий:  

    ```  
    defaults delete com.microsoft.ccmclient SMSID  
    ```  

11. Нажмите кнопку **ОК**, чтобы закрыть диалоговое окно **Создание сценария исправления**.  

12. На странице **Правила соответствия** мастера щелкните **Создать**, а затем в диалоговом окне **Создание правила** укажите приведенные ниже сведения.  

    -   **Имя:удалить SMSID для Mac**  

    -   **Выбранный параметр**: нажмите кнопку **Обзор** и выберите сценарий обнаружения, указанный ранее.  

    -   В поле **следующих значений** введите **Домен/пара по умолчанию (com.microsoft.ccmclient, SMSID) не существует**.  

    -   Включите параметр **Запустить следующий сценарий исправления, если этот параметр не соответствует требованиям**.  

13. Завершите работу мастера создания элементов конфигурации.  

14. Создайте базовую конфигурацию, содержащую только что созданный элемент конфигурации, и разверните ее в коллекции устройств, созданной на шаге 1.  

     Дополнительные сведения о создании и развертывании базовой конфигурации см. в статье [Создание шаблонов базовой конфигурации для параметров соответствия в Configuration Manager](../../../compliance/deploy-use/create-configuration-baselines.md).  

15. После установки нового сертификата на компьютеры Mac с удаленным SMSID выполните следующую команду, чтобы настроить клиент для использования нового сертификата:  

    ```  
    sudo defaults write com.microsoft.ccmclient SubjectName -string <Subject_Name_of_New_Certificate>  
    ```  

16. Если у вас есть несколько сертификатов, содержащих одно и то же значение субъекта, необходимо указать серийный номер сертификата, который предполагается использовать для клиента Configuration Manager. Для этого используйте следующую команду: **sudo defaults write com.microsoft.ccmclient SerialNumber -data "<серийный номер\>"**.  

     Например: **sudo defaults write com.microsoft.ccmclient SerialNumber -data "17D4391A00000003DB"**.  

17. Перезапуск.  


## <a name="see-also"></a>См. также

[Обслуживание клиентов Mac](/sccm/core/clients/manage/maintain-mac-clients)
