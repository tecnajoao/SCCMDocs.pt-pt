---
title: "Поиск ресурсов сайта | Документы Майкрософт"
description: "Сведения о том, как и когда клиенты System Center Configuration Manager находят ресурсы сайта с помощью обнаружения службы."
ms.custom: na
ms.date: 2/7/2017
ms.prod: configuration-manager
ms.reviewer: na
ms.suite: na
ms.technology: configmgr-other
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: ae72df4b-5f5d-4e19-9052-bda28edfbace
caps.latest.revision: "10"
author: Brenduns
ms.author: brenduns
manager: angrobe
ms.openlocfilehash: 1c9e7ada6a8aa228b30e58865baae0f6e529e6af
ms.sourcegitcommit: 51fc48fb023f1e8d995c6c4eacfda7dbec4d0b2f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2017
---
# <a name="learn-how-clients-find-site-resources-and-services-for-system-center-configuration-manager"></a>Сведения о том, как клиенты находят ресурсы и службы сайта для System Center Configuration Manager

*Применимо к: System Center Configuration Manager (Current Branch)*

Клиенты System Center Configuration Manager используют процедуру, называемую *обнаружением службы*, для поиска серверов системы сайта, с которыми они взаимодействуют и которые предоставляют службы, используемые клиентами. Понимание того, как и когда клиенты применяют обнаружение службы для нахождения ресурсов сайта, поможет вам настраивать сайты для поддержки задач клиента. Эти конфигурации могут потребовать, чтобы сайт взаимодействовал с конфигурациями домена и сети, такими как доменные службы Active Directory (AD DS) и DNS. Либо они могут нуждаться в настройке более сложных альтернативных вариантов.  

 Примеры ролей системы сайта, предоставляющих службы:

 - основной сервер системы сайта для клиентов;
 - точка управления;
 - дополнительные серверы системы сайта, с которыми клиент может взаимодействовать, например точки распространения и точки обновления программного обеспечения.  



##  <a name="bkmk_fund"></a> Fundamentals of service location  
 Используя обнаружение службы для поиска точки управления, с которой возможно взаимодействие, клиент оценивает свое текущее расположение в сети, параметры протокола связи и назначенный сайт.  

 **Клиент взаимодействует с точкой управления для выполнения следующих задач:**  
-   Скачивание сведений о других точках управления для сайта, чтобы составить список известных точек управления (который также называется *списком MP*) для будущих циклов обнаружения службы.  
-   Загрузка сведений о конфигурации, таких как инвентаризация и состояние.  
-   Скачивание политики, которая задает конфигурации на стороне клиента и может сообщить клиенту о том программном обеспечении, которое он может или должен установить, а также о других связанных задачах.  
-   Запрос сведений о дополнительных ролях системы сайта, предоставляющих службы, на использование которых был настроен клиент. Например, это могут быть точки распространения программного обеспечения, которые может установить клиент, или точка обновления программного обеспечения для получения обновлений.  

**Клиент Configuration Manager запрашивает обнаружение службы.**  
-   Каждые 25 часов непрерывной работы.  
-   Если клиент обнаруживает изменение своей сетевой конфигурации или расположения.  
-   Если служба **ccmexec.exe** (основная служба клиента) запускается на компьютере.  
-   Когда клиент должен найти роль системы сайта, которая предоставляет необходимую службу.  

**При попытке найти серверы с ролями системы сайта** клиент использует обнаружение службы для поиска роли системы сайта, которая поддерживает клиентский протокол (HTTP или HTTPS). По умолчанию клиенты используют наиболее безопасный метод из доступных. Рекомендуется учесть следующие моменты.  

-   Чтобы использовать протокол HTTPS, требуется инфраструктура открытых ключей (PKI); необходимо установить PKI-сертификаты на клиентах и серверах. Сведения о том, как использовать сертификаты, см. в разделе [Требования к PKI-сертификатам для System Center Configuration Manager](../../../core/plan-design/network/pki-certificate-requirements.md).  

-   При развертывании роли системы сайта, использующей службы IIS и поддерживающей взаимодействие с клиентами, необходимо указать, по какому протоколу клиенты подключаются к системе сайта — HTTP или HTTPS. При использовании HTTP необходимо настроить параметры подписывания и шифрования. Дополнительные сведения см. в разделе [Планирование подписания и шифрования](../../../core/plan-design/security/plan-for-security.md#BKMK_PlanningForSigningEncryption) статьи [Планирование безопасности в System Center Configuration Manager](../../../core/plan-design/security/plan-for-security.md).  

##  <a name="BKMK_Plan_Service_Location"></a> Обнаружение службы и определение клиентами назначенной им точки управления  
Когда клиент впервые выполняет назначение первичному сайту, он выбирает для него точку управления по умолчанию. Первичные сайты поддерживают несколько точек управления, и каждый клиент независимо определяет точку управления в качестве своей точки управления по умолчанию. Затем данная точка управления по умолчанию становится назначенной точкой управления этого клиента. (Вы также можете использовать команды для установки клиента, чтобы задать назначенную точку управления для клиента во время его установки.)  

Клиент выбирает точку управления для дальнейшего взаимодействия на основании текущих конфигураций сетевого расположения и групп границ. Даже при наличии назначенной точки управления клиент может использовать другую точку управления.  

    > [!NOTE]  
    >  A client always uses the assigned management point for registration messages and certain policy messages, even when other communications are sent to a proxy or local management point.  

Вы можете использовать предпочтительные точки управления. Предпочтительные точки управления — это точки управления назначенного сайта клиента, связанные с группой границ, которую клиент использует для поиска серверов системы сайта. Предпочтительная точка управления — это точка, связанная с группой границ в качестве сервера системы сайта, аналогично тому, как точки распространения или точки миграции состояния связаны с группой границ. Если включены предпочтительные точки управления для иерархии, при использовании точки управления с назначенного сайта клиент будет пытаться использовать предпочтительную точку управления перед применением других точек управления назначенного сайта.  

Кроме того, вы можете воспользоваться сведениями из блога на сайте TechNet.com для настройки [сходства точек управления](http://blogs.technet.com/b/jchalfant/archive/2014/09/22/management-point-affinity-added-in-configmgr-2012-r2-cu3.aspx). Сходство точек управления переопределяет работу по умолчанию для назначенных точек управления и позволяет клиенту использовать одну или несколько определенных точек управления.  

Каждый раз, когда клиенту необходимо связаться с точкой управления, он проверяет список MP, который хранит локально в инструментарии управления Windows (WMI). Клиент создает исходный список MP во время установки. Затем он периодически добавляет в него сведения о каждой точке управления в иерархии.  

Если клиент не может найти допустимую точку управления в своем списке MP, он производит поиск по следующим источникам обнаружения службы в указанном порядке, пока не найдет точку управления, которую сможет использовать:  

1.  Точка управления.  
2.  AD DS  
3.  DNS  
4.  WINS  

Когда клиент успешно находит точку управления и связывается с ней, он загружает текущий список точек управления, доступных в иерархии, и обновляет свой локальный список MP. Это в равной степени относится к клиентам, как присоединенным, так и не присоединенным к домену.  

Например, если расположенный в Интернете клиент Configuration Manager подключается к интернет-точке управления, эта точка управления отправляет ему список доступных на сайте интернет-точек управления. Аналогичным образом клиенты, присоединенные к домену или организованные в рабочие группы, получают список точек управления, которые они могут использовать.  

Клиенту, который не настроен для работы в Интернете, точки управления, доступные только через Интернет, не предоставляются. Клиенты рабочей группы, настроенные на работу через Интернет, взаимодействуют исключительно с точками управления, подключенными к Интернету.  

##  <a name="BKMK_MPList"></a> Список точек управления  
Список MP — это предпочтительный источник обнаружения службы для клиента, так как он представляет собой упорядоченный список точек управления, ранее определенных клиентом. Этот список сортируется по каждому клиенту в зависимости от того, где в сети находился клиент во время обновления списка, и затем сохраняется локально на клиенте в инструментарии WMI.  

### <a name="building-the-initial-mp-list"></a>Создание исходного списка точек управления  
Во время установки клиента для построения его исходного списка точек управления применяются следующие правила:  

-   Исходный список содержит точки управления, указанные во время установки клиента (при использовании параметра **SMSMP**= или **/MP**).  
-   Клиент запрашивает у AD DS опубликованные точки управления. Для идентификации из AD DS точка управления должна относиться к назначенному клиенту сайту и иметь ту же версию продукта, что и клиент.  
-   Если во время установки клиента точка управления не была указана, а схема Active Directory не расширена, клиент проверяет DNS и WINS на наличие опубликованных точек управления.  
-   При построении исходного списка сведения о некоторых точках управления в иерархии не могут быть известны.  

### <a name="organizing-the-mp-list"></a>Упорядочение списка MP  
Клиенты упорядочивают свой список точек управления по следующим категориям:  

-   **Прокси** — точка управления на вторичном сайте.  
-   **Локальная** — любая точка управления, сопоставленная с текущим сетевым расположением клиента в соответствии с границами сайта. Обратите внимание на следующие сведения о границах:
    -   Когда клиент входит в несколько групп границ, список локальных точек управления определяется для совокупности всех границ, включающих в себя текущее сетевое расположение клиента.  
    -   Обычно локальные точки управления представляют собой подмножество назначенных клиенту точек управления, если только клиент не находится в сетевом расположении, которое сопоставлено с другим сайтом с точками управления, обслуживающими его группы границ.   


-   **Назначенная**: любая точка управления, которая является системой сайта для назначенного клиенту сайта.  

Вы можете использовать предпочтительные точки управления. Точки управления на сайте, не связанные с группой границ или не входящие в группу границ, связанную с текущим сетевым расположением клиента, не считаются предпочтительными. Они будут использоваться, если клиент не сможет определить предпочтительную точку управления.  

### <a name="selecting-a-management-point-to-use"></a>Выбор используемой точки управления  
Обычно во время взаимодействия клиент пытается использовать точку управления из категорий в указанном ниже порядке в зависимости от своего сетевого расположения:  

1.  Прокси  
2.  Локальная  
3.  назначенных  

Однако клиент всегда использует назначенную точку управления для сообщений регистрации и определенных сообщений политики, даже если остальное взаимодействие осуществляется с прокси-точкой управления или локальной точкой управления.  

Внутри каждой классификации (прокси, локальные или назначенные) клиент пытается использовать соответствующую заданным параметрам точку управления в следующем порядке:  

1.  С поддержкой HTTPS в доверенном или локальном лесу (когда клиент настроен для связи по протоколу HTTPS)  
2.  С поддержкой HTTPS вне доверенного или локального леса (когда клиент настроен для связи по протоколу HTTPS).  
3.  С поддержкой HTTP в доверенном или локальном лесу.  
4.  С поддержкой HTTP вне доверенного или локального леса.  

Из набора точек управления, отсортированных по заданным параметрам, клиент пытается использовать самую первую точку управления в списке. Этот отсортированный список точек управления имеет случайный характер и не может быть упорядочен. Порядок элементов в списке может меняться при обновлении клиентом своего списка точек управления.  

Если клиент не может установить соединение с первой точкой управления, он пробует связаться с каждой последующей точкой управления в списке. Он начинает с предпочтительных точек управления по заданной классификации. Если клиент не может успешно связаться с какой-либо точкой управления в данной классификации, он попытается связаться с предпочтительной точкой управления из следующей классификации и т. д., пока не найдет подходящую точку управления.  

После установления соединения с точкой управления клиент продолжает использовать ее до выполнения одного из следующих условий:  

-   Прошло 25 часов.  
-   Клиенту не удается связаться с точкой управления с пятой попытки в течение 10 минут.

После этого клиент случайным образом выбирает новую точку управления.  

##  <a name="bkmk_ad"></a> Active Directory  
Присоединенные к домену клиенты могут использовать доменные службы Active Directory для обнаружения службы. Для этого сайты должны [публиковать данные в Active Directory](http://technet.microsoft.com/library/hh696543.aspx).  

Клиент может использовать AD DS для обнаружения службы, если выполняются все перечисленные ниже условия.  

-   Схема Active Directory [была расширена](https://technet.microsoft.com/library/mt345589.aspx) для System Center 2012 Configuration Manager.  
-   [Лес Active Directory настроен на публикацию](http://technet.microsoft.com/library/hh696542.aspx), как и сайты Configuration Manager.  
-   Клиентский компьютер входит в домен Active Directory и имеет доступ к серверу глобального каталога.  

Если клиенту не удается найти точку управления для обнаружения службы в доменных службах Active Directory, он предпринимает попытку использовать DNS.  

##  <a name="bkmk_dns"></a> DNS  
Клиенты в интрасети могут использовать DNS для обнаружения службы. Для этого хотя бы один сайт в иерархии должен публиковать сведения о точках управления в DNS.  

Рассмотрите возможность использования DNS для обнаружения службы, если выполняется одно из следующих условий:
-   Схема AD DS не расширена для поддержки Configuration Manager.
-   Клиенты в интрасети расположены в лесу, в котором не включена публикация Configuration Manager.  
-   У вас есть клиенты на компьютерах рабочих групп, не настроенные для управления только через Интернет. (Клиент рабочей группы, настроенный на работу через Интернет, взаимодействует исключительно с точками управления, подключенными к Интернету, и не будет использовать DNS для обнаружения службы.)  
-   Вы можете [настроить клиенты на поиск точек управления в DNS](http://technet.microsoft.com/library/gg682055).  

Когда сайт публикует в DNS записи обнаружения службы для точек управления:  

-   Публикация применяется только к точкам управления, которые принимают клиентские подключения из интрасети.  
-   Публикация добавляет запись ресурса обнаружения службы (SRV RR) в зоне DNS на компьютере точки управления. В DNS для данного компьютера должна существовать соответствующая запись узла.  

По умолчанию присоединенные к домену клиенты выполняют в DNS поиск записей точек управления из локального домена клиента. Вы можете настроить свойство клиента, указывающее доменный суффикс для домена, не имеющего опубликованных в DNS сведений о точке управления.  

Дополнительные сведения о настройке свойства DNS-суффикса клиентов см. в разделе [Настройка клиентских компьютеров на поиск точек управления с использованием публикации DNS в System Center Configuration Manager](../../../core/clients/deploy/configure-client-computers-to-find-management-points-by-using-dns-publishing.md).  

Если клиенту не удается найти точку управления для обнаружения службы в DNS, он предпринимает попытку использовать WINS.  

### <a name="publish-management-points-to-dns"></a>Публикация точек управления в DNS  
Для публикации точек управления в DNS должны быть выполнены следующие два условия.  

-   DNS-серверы поддерживают записи обнаружения службы с использованием BIND версии 8.1.2 или более поздней.  
-   Указанные полные доменные имена точек управления в интрасети, хранящиеся в Configuration Manager, имеют записи узлов (например, записи A) в DNS.  

> [!IMPORTANT]  
>  Реализованная в Configuration Manager публикация в DNS не поддерживает использование несвязанного пространства имен. При наличии несвязанного пространства имен можно вручную опубликовать точки управления в DNS или воспользоваться одним из других методов обнаружения служб, описанных в этом разделе.  

**Если DNS-серверы поддерживают автоматическое обновление**, можно настроить Configuration Manager для автоматической публикации в DNS точек управления, находящихся в интрасети, или же можно вручную опубликовать эти записи в DNS. При публикации точек управления в DNS их полное доменное имя в интрасети и номер порта публикуются в записи обнаружения службы (SRV). Настройка публикации DNS на сайте осуществляется в разделе "Свойства компонента точки управления". Дополнительные сведения см. в разделе [Компоненты сайта для System Center Configuration Manager](../../../core/servers/deploy/configure/site-components.md).  

**Если в зоне DNS для динамического обновления задано значение Secure only (Только безопасное)**, только первая точка управления для публикации в DNS сможет успешно выполнять такое обновление с разрешениями по умолчанию.

Если только одна точка управления может успешно публиковать и изменять свои записи DNS, пока сервер точки управления остается работоспособным, клиенты могут получать из нее полный список точек управления и выбирать среди них нужные точки управления.


**Если DNS-серверы не поддерживают автоматическое обновление, но поддерживают записи обнаружения службы**, можно вручную опубликовать точки управления в DNS. Для этого необходимо вручную указать запись ресурса обнаружения службы (SRV RR) в DNS.  

Configuration Manager поддерживает стандарт записи расположения служб RFC 2782. Эти записи соответствуют следующему формату: *_Service._Proto.Name TTL Class SRV Priority Weight Port Target*.  

Чтобы опубликовать точку управления в Configuration Manager, укажите следующие значения:  

-   **_Service**: введите **_mssms_mp**_&lt;код_сайта\>, где &lt;код_сайта\> — это код сайта точки управления.  
-   **._Proto**: укажите **._tcp**.  
-   **.Name**: введите DNS-суффикс точки управления, например **contoso.com**.  
-   **TTL**: введите **14400**, что составляет четыре часа.  
-   **Класс**: укажите **IN** (в соответствии с RFC 1035).  
-   **Приоритет**: это поле не используется в Configuration Manager.
-   **Вес**: это поле не используется в Configuration Manager.  
-   **Порт**: введите номер порта, используемого точкой управления. Например, **80** для HTTP и **443** для HTTPS.  

    > [!NOTE]  
    >  Порт записи SRV должен соответствовать порту связи, используемому точкой управления. По умолчанию используется порт **80** для HTTP-соединений и порт **443** для HTTPS-соединений.  

-   **Целевой объект**: введите полное доменное имя в интрасети, указанное для системы сайта, для которой настроена роль сайта точки управления.  

При использовании Windows Server DNS можно использовать следующую процедуру ввода DNS-записей для точек управления в интрасети. При использовании другой реализации DNS воспользуйтесь сведениями в этом разделе о значениях полей и обратитесь к документации к серверу DNS для адаптации описанной процедуры.  

##### <a name="to-configure-automatic-publishing"></a>Порядок настройки автоматической публикации:  

1.  В консоли Configuration Manager разверните узлы **Администрирование** > **Конфигурация сайта** > **Сайты**.  

2.  Выберите сайт и щелкните **Настройка компонентов сайта**.  

3.  Выберите **Точка управления**.  

4.  Выберите точки управления, которые необходимо опубликовать. (Этот выбор распространяется на публикацию как в AD DS, так и в DNS.)  

5.  Установите флажок для публикации в DNS. Этот флажок:  

    -   позволяет выбрать точки управления для публикации в DNS;  

    -   не позволяет настроить публикацию в AD DS.  

##### <a name="to-manually-publish-management-points-to-dns-on-windows-server"></a>Публикация точек управления DNS в Windows Server вручную  

1.  В консоли Configuration Manager укажите полные доменные имена систем сайтов.  

2.  В консоли управления DNS выберите зону DNS для компьютера точки управления.  

3.  Убедитесь в наличии записи узла (A или AAAA) для полного доменного имени интрасети системы сайта. Если запись не существует, создайте ее.  

4.  В разделе **New Other Records** (Новые прочие записи) выберите параметр **Размещение службы (SRV - Service Location)** в диалоговом окне **Тип записи ресурса**, щелкните **Create Record** (Создать запись), введите приведенную ниже информацию и нажмите кнопку **Готово**.  

    -   **Домен**: если необходимо, введите DNS-суффикс точки управления, например **contoso.com**.  
    -   **Служба**: введите **_mssms_mp**_&lt;код_сайта\>, где &lt;код_сайта\> — это код сайта точки управления.  
    -   **Протокол**: введите **_tcp**.  
    -   **Приоритет**: это поле не используется в Configuration Manager.  
    -   **Вес**: это поле не используется в Configuration Manager.  
    -   **Порт**: введите номер порта, используемого точкой управления. Например, **80** для HTTP и **443** для HTTPS.  

        > [!NOTE]  
        >  Порт записи SRV должен соответствовать порту связи, используемому точкой управления. По умолчанию используется порт **80** для HTTP-соединений и порт **443** для HTTPS-соединений.  

    -   **Узел этой службы**: введите полное доменное имя в интрасети, указанное для системы сайта, для которой настроена роль сайта точки управления.  

Повторите эти действия для каждой точки управления в интрасети, которую нужно опубликовать в DNS.  

##  <a name="bkmk_wins"></a> WINS  
В случае сбоя других механизмов обнаружения службы клиенты могут найти исходную точку управления, проверив WINS.  

По умолчанию первичный сайт публикует в WINS первую точку управления на сайте, настроенную на использование протокола HTTP, и первую точку управления, настроенную на использование протокола HTTPS.  

Если не требуется, чтобы клиенты находили точку управления HTTP в WINS, настройте их с помощью CCMSetup.exe Client.msi **SMSDIRECTORYLOOKUP=NOWINS**.  
