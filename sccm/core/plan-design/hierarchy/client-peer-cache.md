---
title: "Одноранговый кэш клиента | System Center Configuration Manager"
description: "Используйте одноранговый кэш для расположений источников клиентского содержимого при развертывании содержимого с помощью System Center Configuration Manager."
ms.custom: na
ms.date: 7/31/2017
ms.reviewer: na
ms.suite: na
ms.prod: configuration-manager
ms.technology: configmgr-other
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 86cd5382-8b41-45db-a4f0-16265ae22657
caps.latest.revision: "3"
author: Brenduns
ms.author: brenduns
manager: angrobe
ms.openlocfilehash: 89fcd16887ae77299f9d18472ee6a1ba56794eca
ms.sourcegitcommit: 51fc48fb023f1e8d995c6c4eacfda7dbec4d0b2f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2017
---
# <a name="peer-cache-for-configuration-manager-clients"></a>Одноранговый кэш для клиентов Configuration Manager

*Применимо к: System Center Configuration Manager (Current Branch)*

Начиная с System Center Configuration Manager версии 1610 можно использовать **одноранговый кэш** для управления развертыванием содержимого для клиентов в удаленных расположениях. Одноранговый кэш — это встроенное решение Configuration Manager, которое позволяет клиентам делиться содержимым с другими клиентами непосредственно из своего локального кэша.   

> [!TIP]  
> Представленные в версии 1610, одноранговый кэш и панель мониторинга "Источники данных клиента" находятся на стадии предварительного выпуска. Сведения об их включении см. в разделе [Использование функций предварительной версии из обновлений](/sccm/core/servers/manage/pre-release-features).

## <a name="overview"></a>Обзор
Клиент однорангового кэша — это клиент Configuration Manager, который поддерживает использование однорангового кэша. Клиент однорангового кэша с содержимым, к которому можно предоставить доступ дополнительным клиентам, является источником однорангового кэша.
 -  С помощью параметров клиента настройте для клиентов использование однорангового кэша.
 -  Чтобы предоставить доступ к содержимому в качестве источника однорангового кэша, клиент однорангового кэша должен соответствовать следующим требованиям.
    -  Клиент должен быть присоединен к домену. Но клиент, который не присоединен к домену, может получить содержимое из источника однорангового кэша, присоединенного к домену.
    -  Клиент должен быть членом текущей группы границ, из которой он пытается получить содержимое. Клиент однорангового кэша в соседних группах границ не включается в пул доступных расположений источников содержимого, когда клиент использует откат для поиска содержимого из соседней группы границ. Дополнительные сведения о текущих и соседних группах границ см. в разделе [Группы границ](/sccm/core/servers/deploy/configure/define-site-boundaries-and-boundary-groups##a-namebkmkboundarygroupsa-boundary-groups).
 - Каждый тип содержимого, которое хранится в кэше клиента Configuration Manager, может предоставляться другим клиентам, использующим одноранговый кэш.
 -  Одноранговый кэш не заменяет других решений, таких как BranchCache, а работает параллельно с ними, дополняя традиционные методы развертывания содержимого, такие как точки распространения. Так как это специализированное решение не использует BranchCache, оно будет работать, даже если Windows BranchCache не используется.

### <a name="operations"></a>Операции

После развертывания клиентских параметров, включающих одноранговый кэш в коллекции, члены этой коллекции могут выступать в качестве источника однорангового содержимого для других клиентов в той же группе границ.
 -  Клиент, который выступает в качестве источника однорангового содержимого, передает список доступного кэшированного содержимого в свою точку управления.
 -  Затем, когда следующий клиент в этой группе границ запрашивает данное содержимое, каждый источник однорангового кэша с этим содержимым возвращается в качестве потенциального источника вместе с точками распространения и другими расположениями источников содержимого в этой группе границ.
 -  В обычном режиме клиент, ищущий содержимое, выбирает один источник содержимого из предоставленного ему пула источников, после чего пытается получить содержимое.

> [!NOTE]
> Если происходит откат к соседней группе границ, расположения источников содержимого в одноранговом кэше из соседней группы границ не добавляются в пул потенциальных расположений источников содержимого для клиента.  


Вы можете включить все клиенты в одноранговый кэш в качестве источников. Но мы рекомендуем выбирать только те, которые лучше подходят в качестве источников однорангового кэша.  Для определения подходящих клиентов можно воспользоваться такими характеристиками клиента, как тип корпуса, объем дискового пространства, сетевое подключение и др. Дополнительные сведения о выборе подходящих клиентов для однорангового кэша см. в [этом блоге консультанта Майкрософт](https://blogs.technet.microsoft.com/setprice/2016/06/29/pe-peer-cache-custom-reporting-examples/).

**Ограниченный доступ к источнику однорангового кэша**  
Начиная с версии 1702 компьютер-источник однорангового кэша отклоняет запросы на получение содержимого, если для него выполняется любое из указанных ниже условий.  
  -  Находится в режиме низкого заряда батареи.
  -  Загрузка ЦП превышает 80 % во время запроса на содержимое.
  -  Значение параметра *AvgDiskQueueLength* дисковых операций ввода-вывода превышает 10.
  -  Отсутствуют доступные подключения к компьютеру.   

Эти параметры можно настроить с помощью функции источника однорангового кэша (*SMS_WinPEPeerCacheConfig*) из класса WMI для сервера конфигурации клиента, используя пакет SDK для System Center Configuration Manager.

Когда компьютер отклоняет запрос на содержимое, запрашивающий компьютер будет продолжать поиск содержимого из альтернативных источников, включенных в пул доступных источников содержимого.   



### <a name="monitoring"></a>monitoring   
Чтобы лучше понять, когда клиенты успешно используют одноранговый кэш, просмотрите панель мониторинга "Источники данных клиента". См. раздел [Панель мониторинга "Источники данных клиента"](/sccm/core/servers/deploy/configure/monitor-content-you-have-distributed#client-data-sources-dashboard).

Начиная с версии 1702 вы можете использовать три отчета для контроля использования однорангового кэша. В консоли перейдите к пункту **Мониторинг** > **Отчетность** > **Отчеты**. Все отчеты имеют тип **содержимого для распространения ПО**.
1.  **Отклонение содержимого источником однорангового кэша**.  
Этот отчет позволяет понять, как часто источники однорангового кэша, включенные в группу границ, отклоняли запрос на содержимое.
 - **Известная проблема**. При детализации результатов, например по параметрам *MaxCPULoad* или *MaxDiskIO*, может появляться сообщение о невозможности найти отчет или подробные сведения. Чтобы решить эту проблему, используйте следующие два отчета, которые отображают результаты непосредственно.

2. **Отклонение содержимого источником однорангового кэша с разбивкой по условиям**.  
Этот отчет позволяет оценить причины отклонения содержимого для определенной группы границ или типа отклонения. Вы можете указать следующее.

  - **Известная проблема**. Невозможно выбрать доступные параметры, — их нужно вводить вручную. Введите значения для *имени группы границ* и *типа отклонения*, как показано в первом отчете. Например, для *типа отклонения* можно ввести *MaxCPULoad* или *MaxDiskIO*.

3. **Подробные сведения об отклонении содержимого источником однорангового кэша**.   
  Этот отчет позволяет изучить, запросы на какое содержимое отклонялись.

 - **Известная проблема**. Невозможно выбрать доступные параметры, — их нужно вводить вручную. Введите значение для *типа отклонения*, как показано в первом отчете ("Отклонение содержимого источником однорангового кэша"), а затем введите *идентификатор ресурса* того источника содержимого, по которому нужно получить дополнительные сведения.  Чтобы найти идентификатор ресурса для источника содержимого, выполните следующие действия.  

    1. Найдите имя компьютера, которое отображается как *Источник однорангового кэша* в результатах второго отчета ("Отклонение содержимого источником однорангового кэша с разбивкой по условиям").  
    2. Теперь перейдите к разделу **Активы и соответствие** > **Устройства** и выполните поиск этого имени компьютера. Используйте значение из столбца идентификатора ресурса.  


## <a name="requirements-and-considerations-for-peer-cache"></a>Требования и рекомендации для однорангового кэша
-   Одноранговый кэш поддерживается в ОС Windows, которая поддерживается в качестве клиента Configuration Manager. Операционные системы, отличные от Windows, не поддерживают одноранговый кэш.

-   Клиенты могут передавать содержимое только от клиентов однорангового кэша, находящихся в текущей группе границ.

-   В версиях до 1706 на каждом сайте, где клиенты используют одноранговый кэш, должна быть настроена [учетная запись доступа к сети](/sccm/core/plan-design/hierarchy/manage-accounts-to-access-content#a-namebkmknaaa-network-access-account). Начиная с версии 1706 эта учетная запись нужна только в одном случае.  Речь идет о ситуации, когда клиент использует одноранговый кэш для получения и выполнения последовательности задач из центра программного обеспечения и последовательность задач перезагружает клиент в среду WinPE.  В этом сценарии клиенту по-прежнему требуется учетная запись доступа к сети, когда он находится в среде WinPE, чтобы иметь доступ к источнику однорангового кэша для получения содержимого.

    Когда учетная запись доступа к сети необходима, она используется на исходном компьютере однорангового кэша для проверки подлинности запросов на скачивание от одноранговых узлов. Для этого ей требуются только разрешения пользователя домена.

-   Так как текущие границы источника содержимого в одноранговом кэше определяются параметрами, указанными в последнем отправленном клиентом перечне оборудования, то при переносе клиента в сетевое расположение, входящее в другую группу границ, этот клиент может по-прежнему считаться членом своей бывшей группы границ в контексте однорангового кэша. Это может привести к тому, что клиент будет предлагаться как источник содержимого однорангового кэша, находящийся в другом сетевом расположении. Такие клиенты рекомендуется исключать из источников однорангового кэша.

## <a name="to-configure-client-peer-cache-client-settings"></a>Настройка параметров однорангового кэша клиента
1.  В консоли Configuration Manager выберите пункты **Администрирование** > **Параметры клиента**, а затем откройте объект параметров клиента устройства, который будет использоваться. Можно также изменить объект параметров клиента по умолчанию.
2.  В списке доступных параметров выберите **Параметры кэша клиента**.
3.  Задайте для параметра **Включить клиент Configuration Manager в полной ОС для совместного использования содержимого** значение **Да**.
4.  Настройте следующие параметры, чтобы определить порты, которые необходимо использовать для однорангового кэша.  
  -  **Порт для первоначальной широковещательной передачи по сети**
  -  **Включить HTTPS для одноранговой связи клиентов**
  -  **Порт для скачивания контента с однорангового компьютера (HTTP/HTTPS)**

На каждом компьютере с поддержкой однорангового кэша, на котором используется брандмауэр Windows, Configuration Manager настраивает брандмауэр так, чтобы разрешить использование настроенных вами портов.
