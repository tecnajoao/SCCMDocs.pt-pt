---
title: "Методы обнаружения | Документы Майкрософт"
ms.custom: na
ms.date: 07/31/2017
ms.prod: configuration-manager
ms.reviewer: na
ms.suite: na
ms.technology: configmgr-other
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: ed931751-18f2-4230-a09e-a0a329fbfa1c
caps.latest.revision: "8"
author: Brenduns
ms.author: brenduns
manager: angrobe
ms.openlocfilehash: 442e5e1fbddd00248819a8de79adc78929474fc0
ms.sourcegitcommit: 51fc48fb023f1e8d995c6c4eacfda7dbec4d0b2f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2017
---
# <a name="about-discovery-methods-for-system-center-configuration-manager"></a>Сведения о методах обнаружения для System Center Configuration Manager

*Применимо к: System Center Configuration Manager (Current Branch)*

Методы обнаружения System Center Configuration Manager позволяют находить разные устройства в сети или устройства и пользователей в Active Directory. Для эффективного использования метода обнаружения необходимо понимать его конфигурации и ограничения.  

##  <a name="bkmk_aboutForest"></a> Обнаружение в лесах Active Directory  
 **Возможность настройки**: да  

 **Включено по умолчанию**: нет  

 **Учетные записи**, используемые для этого метода:  

-   **Учетная запись обнаружения лесов Active Directory** (определяется пользователем)  

-   **Учетная запись** компьютера сервера сайта  

В отличие от других методов обнаружения Active Directory, метод обнаружения в лесах Active Directory не используется для поиска ресурсов, которыми можно управлять. При применении этого метода выполняется обнаружение сетевых расположений, которые настроены в Active Directory и могут быть преобразованы в границы, используемые в пределах иерархии.  

Этот метод выполняет поиск в локальном лесу Active Directory, каждом доверенном лесу и в каждом дополнительном лесу, настроенном в узле **Леса Active Directory** консоли Configuration Manager.  

Метод обнаружения в лесах Active Directory используется для решения следующих задач:  

-   Обнаружение сайтов и подсетей Active Directory с последующим созданием границ Configuration Manager на основе этих сетевых расположений.  

-   Определение суперсетей, назначенных сайту Active Directory, и преобразование каждой суперсети в границу диапазона IP-адресов.  

-   Публикация в доменных службах Active Directory (AD DS) леса, если публикация в этом лесу включена и указанная учетная запись леса Active Directory имеет разрешения для этого леса.  

Управление методом обнаружения в лесах Active Directory осуществляется в консоли Configuration Manager из следующих узлов, вложенных в узел **Конфигурация иерархии** в рабочей области **Администрирование**.  

-   **Методы обнаружения**. Здесь можно включить выполнение метода обнаружения в лесах Active Directory на сайте верхнего уровня в иерархии. Можно также задать простое расписание выполнения обнаружения и настроить обнаружение для автоматического создания границ из найденных IP-подсетей и сайтов Active Directory. Метод обнаружения в лесах Active Directory нельзя запускать на дочернем первичном сайте или на вторичном сайте.  

-   **Леса Active Directory**. Здесь выполняется настройка дополнительных лесов Active Directory, которые требуется найти, указывается учетная запись, используемая в качестве учетной записи леса Active Directory, для каждого леса и настраивается публикация в каждом лесу. Кроме того, можно отслеживать процесс обнаружения и добавлять IP-подсети и сайты Active Directory в Configuration Manager в качестве границ и членов групп границ.  

Чтобы настроить публикацию для лесов Active Directory в каждом сайте иерархии, подключите консоль Configuration Manager к сайту верхнего уровня иерархии. На вкладке **Публикация** в диалоговом окне **Свойства** сайта Active Directory отображается только текущий сайт и его подчиненные сайты. Если для леса включена публикация и схема этого леса расширена для Configuration Manager, для каждого сайта, который включен для публикации в этом лесу Active Directory, публикуются следующие данные:  

-    **SMS-Site-&lt;код сайта>**

-   **SMS-MP-&lt;код сайта>-&lt;имя сервера системы сайта>**  

-   **SMS-SLP-&lt;код сайта>-&lt;имя сервера системы сайта>**  

-   **SMS-&lt;код сайта>-&lt;имя сайта Active Directory или подсети>**  

> [!NOTE]  
>  Для публикации в Active Directory вторичные сайты всегда используют учетную запись компьютера сервера вторичного сайта. Чтобы вторичные сайты выполняли публикацию в Active Directory, учетная запись компьютера сервера вторичного сайта должна иметь разрешения на публикацию в Active Directory. Вторичный сайт не может публиковать данные в лесу, не имеющем доверия.  

> [!CAUTION]  
>  При отключении параметра публикации сайта в лесу Active Directory все ранее опубликованные сведения для этого сайта, включая доступные роли систем сайта, удаляются из Active Directory.  

Действия метода обнаружения в лесах Active Directory записываются в следующие журналы.  

-   Сведения обо всех действиях, за исключением действий, связанных с публикацией, записываются в файл **ADForestDisc.Log** в папке **&lt;путь_установки>\Logs** на сервере сайта.  

-   Действия публикации, выполняемые при обнаружении в лесах Active Directory, записываются в файлы **hman.log** и **sitecomp.log** в папке **&lt;путь_установки>\Logs** на сервере сайта.  

Дополнительные сведения о настройке этого метода обнаружения см. в разделе [Настройка методов обнаружения для System Center Configuration Manager](../../../../core/servers/deploy/configure/configure-discovery-methods.md).  

##  <a name="bkmk_aboutGroup"></a> Обнаружение групп Active Directory  
**Возможность настройки**: да  

**Включено по умолчанию**: нет  

**Учетные записи**, используемые для этого метода:  

-   **Учетная запись обнаружения групп Active Directory** (определяется пользователем)  

-   **Учетная запись** компьютера сервера сайта  

> [!TIP]  
>  Помимо сведений в этом разделе, см. раздел [Общие возможности методов обнаружения групп, систем и пользователей Active Directory](#bkmk_shared).  

Используйте этот метод для выполнения поиска в доменных службах Active Directory следующих компонентов:  

-   локальные, глобальные и универсальные группы безопасности;  

-   членство в группах;  

-   ограниченные сведения о входящих в группу компьютерах и пользователях, даже если эти компьютеры и пользователи не были ранее обнаружены с помощью другого метода обнаружения.  

Этот метод обнаружения предназначен для поиска групп и отношений групп для членов групп. По умолчанию обнаруживаются только группы безопасности. Чтобы обнаруживать членство в группах распространения, в диалоговом окне **Свойства метода обнаружения групп Active Directory** на вкладке **Вариант** необходимо установить флажок **Обнаруживать членство в группах распространения**.  

Метод обнаружения групп Active Directory не поддерживает расширенные атрибуты Active Directory, которые могут быть найдены с помощью метода обнаружения систем Active Directory или метода обнаружения пользователей Active Directory. Поскольку этот метод обнаружения не оптимизирован для обнаружения ресурсов компьютеров и пользователей, его рекомендуется запускать после выполнения метода обнаружения систем Active Directory и метода обнаружения пользователей Active Directory. Причина в том, что этот метод создает полную запись данных обнаружения для групп и ограниченную запись для компьютеров и пользователей, входящих в группы.  

Можно настроить следующие области обнаружения, определяющие то, каким образом этот метод обнаружения выполняет поиск данных.  

-   **Расположение**. Используется при поиске в одном или нескольких контейнеров Active Directory. Этот параметр области поддерживает рекурсивный поиск указанных контейнеров Active Directory, а также поиск каждого контейнера, являющегося дочерним для указанного контейнера. Этот процесс продолжается до тех пор, пока не будут обнаружены все дочерние контейнеры.  

-   **Группы**. Используются при поиске одной или нескольких конкретных групп Active Directory. **Домен Active Directory** можно настроить для использования домена и леса по умолчанию или ограничить поиск отдельным контроллером домена. Кроме того, можно указать одну или несколько групп для поиска. Если не будет указана хотя бы одна группа, будет выполняться поиск всех групп в указанном расположении **Домен Active Directory** .  

> [!CAUTION]  
>  При настройке области обнаружения выберите только те группы, которые необходимо обнаружить. Это нужно сделать, так как в ходе обнаружения групп Active Directory предпринимается попытка поиска каждого участника каждой группы в области обнаружения. Поиск больших групп может быть связан с использованием значительного количества ресурсов сети и Active Directory.  

> [!NOTE]  
>  Прежде чем вы сможете создать коллекции на основе расширенных атрибутов Active Directory и обеспечить точность результатов обнаружения для компьютеров и пользователей, необходимо выполнить метод обнаружения систем Active Directory или метод обнаружения пользователей Active Directory, в зависимости от необходимых вам данных.  

Действия метода обнаружения групп Active Directory записываются в файл **adsgdis.log** в папке **&lt;путь_установки\>\LOGS** на сервере сайта.  

Дополнительные сведения о настройке этого метода обнаружения см. в разделе [Настройка методов обнаружения для System Center Configuration Manager](../../../../core/servers/deploy/configure/configure-discovery-methods.md).  

##  <a name="bkmk_aboutSystem"></a> Обнаружение систем Active Directory  
**Возможность настройки**: да  

**Включено по умолчанию**: нет  

**Учетные записи**, используемые для этого метода:  

-   **Учетная запись обнаружения систем Active Directory** (определяется пользователем)  

-   **Учетная запись** компьютера сервера сайта  

> [!TIP]  
>  Помимо сведений в этом разделе, см. раздел [Общие возможности методов обнаружения групп, систем и пользователей Active Directory](#bkmk_shared).  

Этот метод обнаружения применяется для поиска ресурсов компьютеров, которые можно использовать для создания коллекций и запросов, в указанных расположениях доменных служб Active Directory. Кроме того, можно установить клиент Configuration Manager на обнаруженном устройстве с помощью принудительной установки клиента.  

По умолчанию этот метод находит основные сведения о компьютере, включая следующую информацию:  

-   Имя компьютера  

-   Название и версия операционной системы  

-   Имя контейнера Active Directory  

-   IP-адрес  

-   Сайт Active Directory  

-   Метка времени последнего входа в систему  

Для успешного создания записи данных обнаружения для компьютера метод обнаружения систем Active Directory должен определить учетную запись компьютера и затем успешно разрешить имя компьютера в IP-адрес.  

На вкладке **Атрибуты Active Directory** в диалоговом окне **Свойства метода обнаружения систем Active Directory** можно просмотреть полный список атрибутов объектов по умолчанию, возвращенный методом обнаружения систем Active Directory. Кроме того, можно настроить метод обнаружения дополнительных (расширенных) атрибутов.  

Действия метода обнаружения систем Active Directory записываются в файл **adsysdis.log** в папке **&lt;путь_установки\>\LOGS** на сервере сайта.  

Дополнительные сведения о настройке этого метода обнаружения см. в разделе [Настройка методов обнаружения для System Center Configuration Manager](../../../../core/servers/deploy/configure/configure-discovery-methods.md).  

##  <a name="bkmk_aboutUser"></a> Обнаружение пользователей Active Directory  
**Возможность настройки**: да  

**Включено по умолчанию**: нет  

**Учетные записи**, используемые для этого метода:  

-   **Учетная запись обнаружения пользователей Active Directory** (определяется пользователем)  

-   **Учетная запись** компьютера сервера сайта  

> [!TIP]  
>  Помимо сведений в этом разделе, см. раздел [Общие возможности методов обнаружения групп, систем и пользователей Active Directory](#bkmk_shared).  

Этот метод обнаружения используется для поиска учетных записей пользователей и связанных с ними атрибутов в доменных службах Active Directory. По умолчанию этот метод обнаружения находит основные сведения об учетной записи пользователя, включая следующую информацию:  

-   Имя пользователя  

-   Уникальное имя пользователя (включает имя домена)  

-   Домен  

-   Имена контейнеров Active Directory  

На вкладке **Атрибуты Active Directory** в диалоговом окне **Свойства метода обнаружения пользователей Active Directory** можно просмотреть полный список атрибутов объектов по умолчанию, возвращенный методом обнаружения пользователей Active Directory. Кроме того, можно настроить метод обнаружения дополнительных (расширенных) атрибутов.

Действия метода обнаружения пользователей Active Directory записываются в файл **adusrdis.log** в папке **&lt;путь_установки\>\LOGS** на сервере сайта.  

Дополнительные сведения о настройке этого метода обнаружения см. в разделе [Настройка методов обнаружения для System Center Configuration Manager](../../../../core/servers/deploy/configure/configure-discovery-methods.md).  

## <a name="azureaddisc"></a> Обнаружение пользователя Azure Active Directory
Начиная с версии 1706 можно использовать обнаружение пользователей Active Directory Azure (Azure AD) при настройке среды для использования служб Azure.
Используйте этот метод обнаружения для поиска пользователей в Azure AD, которые проходят проверку подлинности в вашем экземпляре Azure AD, чтобы найти следующие атрибуты:  
-   objectId
-   displayName
-   почта
-   mailNickname
-   onPremisesSecurityIdentifier
-   userPrincipalName
-   AAD tenantID

Этот метод поддерживает полную синхронизацию и разностную синхронизацию данных пользователя Azure AD. Эти сведения можно затем использовать вместе с данными обнаружения, которые собираются с помощью других методов обнаружения.

Действия обнаружения пользователей Azure AD записываются в файл SMS_AZUREAD_DISCOVERY_AGENT.log на сервере сайта верхнего уровня иерархии.

Чтобы настроить обнаружение пользователя Azure AD, используйте мастер служб Azure.  Дополнительные сведения о настройке этого метода обнаружения см. в статье [Настройка методов обнаружения для System Center Configuration Manager](/sccm/core/servers/deploy/configure/configure-discovery-methods).





##  <a name="bkmk_aboutHeartbeat"></a> Heartbeat-обнаружение  
**Возможность настройки**: да  

**Включено по умолчанию**: да  

**Учетные записи**, используемые для этого метода:  

-   **Учетная запись** компьютера сервера сайта  

Heartbeat-обнаружение отличается от других методов обнаружения Configuration Manager. Оно включено по умолчанию и работает на каждом компьютере-клиенте (а не на сервере сайта), обеспечивая создание записи данных обнаружения. Для клиентов, представляющих собой мобильные устройства, такая запись создается точкой управления, которую использует данный клиент. Чтобы не сбивать ведение записей о клиентах Configuration Manager в базе данных, не отключайте Heartbeat-обнаружение. Помимо обслуживания записи в базе данных, этот метод позволяет принудительно обнаружить компьютер с созданием для него новой записи о ресурсе или повторно заполнить запись в базе данных о компьютере, который был удален из базы.  

Heartbeat-обнаружение выполняется по расписанию, установленному для всех клиентов в иерархии, или вызывается вручную на конкретном клиенте путем запуска варианта **Цикл сбора обнаруживаемых данных** на вкладке **Действие** клиентского приложения Configuration Manager. По умолчанию расписание пакета пульса регламентирует отправку раз в 7 дней. При изменении интервала обнаружения пакета пульса убедитесь, что этот метод запускается чаще, чем задача обслуживания сайта **Удалить устаревшие данные обнаружения**, которая удаляет записи неактивных клиентов из базы данных сайта. Задача **Удаление устаревших данных обнаружения** может быть настроена только для первичных сайтов.  

В процессе Heartbeat-обнаружения создается запись данных обнаружения, содержащая текущие сведения о клиенте, включая указанные ниже. Клиент затем копирует этот небольшой файл (примерно 1 КБ) в точку управления для последующей обработки первичным сайтом. Файл содержит следующие сведения:  

-   Сетевое расположение  

-   Имя NetBIOS  

-   Версия агента клиента  

-   Сведения об оперативном состоянии  

Heartbeat-обнаружение — это единственный метод, позволяющий получить данные о состоянии установки клиента. Это достигается путем присвоения клиентскому атрибуту системного ресурса значения **Да**.  

> [!NOTE]  
>  Даже когда Heartbeat-обнаружение отключено, для активных мобильных клиентов записи обнаружения данных по-прежнему создаются и передаются в базу данных. Тем самым гарантируется, что задача **Удаление устаревших данных обнаружения** не затронет активные мобильные устройства. Это выполняется, поскольку если в ходе выполнения задачи **Удаление устаревших данных обнаружения** из базы данных удаляется запись о мобильном устройстве, при этом также отзывается сертификат устройства и блокируется его подключение к точкам управления.  

Действия Heartbeat-обнаружения регистрируются в следующих расположениях:  

-   для клиентов-компьютеров — в файле **InventoryAgent.log** в папке *%Windir%\CCM\Logs*;  

-   для клиентов-мобильных устройств — в файле **DMPRP.log** в папке *%Program Files%\CCM\Logs* точки управления, которую использует клиент.  

Дополнительные сведения о настройке этого метода обнаружения см. в разделе [Настройка методов обнаружения для System Center Configuration Manager](../../../../core/servers/deploy/configure/configure-discovery-methods.md).  

##  <a name="bkmk_aboutNetwork"></a> Обнаружение сети  
**Возможность настройки**: да  

**Включено по умолчанию**: нет  

**Учетные записи**, используемые для этого метода:  

-   **Учетная запись** компьютера сервера сайта  

Этот метод используется для обнаружения топологии сети и устройств в сети, которым назначен IP-адрес. В ходе обнаружения сетевых ресурсов ведется поиск в сети ресурсов с поддержкой протокола IP путем запросов к серверам, на которых работает реализация DHCP корпорации Майкрософт, ARP-кэшу маршрутизаторов, устройствам с поддержкой SNMP и доменам Active Directory.  

Чтобы использовать обнаружение сетевых ресурсов, необходимо задать требуемый *уровень* обнаружения. Можно также настроить один или несколько механизмов обнаружения, позволяющих запрашивать сетевые сегменты или устройства в ходе обнаружения сетевых ресурсов. Кроме того, можно задать параметры, управляющие действиями по обнаружению в сети. Наконец, есть возможность задать одно или несколько расписаний, по которым будет выполняться обнаружение сетевых ресурсов.  

Для успешного обнаружения сетевого ресурса с помощью этого метода необходимо, чтобы был определен IP-адрес и маска подсети ресурса. Используются следующие методы определения маски подсети объекта.  

-   **Кэш ARP маршрутизатора**. Сетевое обнаружение запрашивает в кэше ARP маршрутизатора сведения о подсети. Как правило, данные в кэше ARP маршрутизатора имеют небольшой срок хранения. Таким образом, когда служба сетевого обнаружения запрашивает кэш ARP, последний уже может не содержать сведения о рассматриваемом объекте.  

-   **DHCP**. Служба сетевого обнаружения запрашивает каждый указанный DHCP-сервер на предмет обнаружения устройств, которым была предоставлена аренда канала со стороны DHCP-сервера. Обнаружение сетевых ресурсов поддерживает только DHCP-серверы, на которых работает реализация DHCP, принадлежащая корпорации Майкрософт.  

-   **Устройство SNMP**. Служба сетевого обнаружения может напрямую запрашивать устройство SNMP. Для запроса устройства службой сетевого обнаружения необходимо, чтобы на устройстве был установлен локальный SNMP-агент. Кроме того, необходимо настроить службу сетевого обнаружения для применения имени сообщества, которое использует агент SNMP.  

Когда в ходе обнаружения выявляется объект с IP-адресом, для которого удается определить маску подсети, для этого объекта создается запись данных обнаружения. Поскольку к сети могут подключаться разнотипные устройства, обнаружение сетевых ресурсов позволяет выявлять ресурсы, не поддерживающие клиентское программное обеспечение Configuration Manager. Примерами устройств, которые допускают обнаружение, но не управление, являются принтеры и маршрутизаторы.  

В ходе обнаружения сетевых ресурсов может возвращаться ряд атрибутов, которые входят в состав создаваемой записи данных обнаружения. Сюда входит следующее.  

-   Имя NetBIOS  

-   IP-адреса  

-   Домен ресурса  

-   Системные роли  

-   Имя сообщества SNMP  

-   MAC-адреса  

Действие по обнаружению сетевых ресурсов регистрируется в файле **Netdisc.log** в папке *&lt;путь_установки\>\Logs* на сервере сайта, который выполняет обнаружение.  

 Дополнительные сведения о настройке этого метода обнаружения см. в разделе [Настройка методов обнаружения для System Center Configuration Manager](../../../../core/servers/deploy/configure/configure-discovery-methods.md).  

> [!NOTE]  
>  Сложная топология сетей и низкая пропускная способность каналов связи может привести к тому, что обнаружение сетевых ресурсов будет выполняться медленно и создаст большой объем трафика. Рекомендуется запускать обнаружение сетевых ресурсов только в том случае, когда не удается найти нужные ресурсы с помощью других методов обнаружения. Например, использовать обнаружение сетевых ресурсов следует, если требуется обнаружить компьютеры рабочей группы. Другие методы не позволяют обнаруживать такие компьютеры.  

###  <a name="BKMK_NetDiscLevels"></a> Уровни обнаружения сетевых ресурсов  
При настройке обнаружения сетевых ресурсов задается один из трех уровней обнаружения:  

|Уровень обнаружения|Подробные сведения|  
|------------------------|-------------|  
|Топология|На этом уровне обнаруживаются маршрутизаторы и подсети, но не определяется маска подсети объектов.|  
|Топология и клиент|Помимо топологии, на этом уровне обнаруживаются потенциальные клиенты (например, компьютеры) и ресурсы (например, принтеры и маршрутизаторы). На данном уровне обнаружения предпринимается попытка определить маску подсети найденных объектов.|  
|Топология, клиент и операционная система клиента|Помимо топологии и потенциальных клиентов, на этом уровне предпринимается попытка определить название и версию операционной системы компьютера. На данном уровне вызываются API браузера и сетевой поддержки Windows.|  

 Чем выше уровень, тем больше выполняется действий и тем интенсивнее используется пропускная способность сети в процессе обнаружения сетевых ресурсов. Следует учесть потенциальный объем генерируемого сетевого трафика, прежде чем включать все возможности сетевого обнаружения.  

 Например, если обнаружение сетевых ресурсов используется впервые, можно начать с уровня топологии и определить сетевую инфраструктуру. После этого можно перенастроить обнаружение для поиска объектов и определения операционных систем, установленных на соответствующих устройствах. Можно также настроить параметры, ограничивающие обнаружение сетевых ресурсов конкретным диапазоном сетевых сегментов. Это позволяет обнаруживать объекты только в нужных сетевых расположениях, не вырабатывая лишний сетевой трафик, а также обнаруживать объекты за пограничными маршрутизаторами или за пределами сети.  

###  <a name="BKMK_NetDiscOptions"></a> Параметры обнаружения сетевых ресурсов  
Чтобы включить поиск адресуемых по протоколу IP устройств при обнаружении сетевых ресурсов, необходимо задать один или несколько следующих параметров, определяющих, как будет производиться запрос устройств.  

> [!NOTE]  
>  Обнаружение сетевых ресурсов выполняется в контексте учетной записи компьютера того сервера сайта, который выполняет обнаружение. Если учетная запись компьютера не имеет разрешений на доступ в ненадежный домен, ресурсы могут не обнаруживаться из-за конфигурации как самого домена, так и DHCP-сервера.  

**DHCP**  

Укажите каждый DHCP-сервер, к которому следует делать запросы при обнаружении сетевых ресурсов. (Обнаружение сетевых ресурсов поддерживает только DHCP-серверы, на которых работает реализация DHCP, принадлежащая корпорации Майкрософт.)  

-   Считывание информации при обнаружении сетевых ресурсов производится из базы данных на DHCP-сервере путем удаленных вызовов процедур (RPC).  

-   Обнаружение сетевых ресурсов предусматривает возможность запрашивать у 32- и 64-разрядных DHCP-серверов список устройств, зарегистрированных на каждом сервере.  

-   Для успешного запроса к DHCP-серверу при обнаружении сетевых ресурсов необходимо, чтобы учетная запись компьютера того сервера, который выполняет обнаружение, входила в группу "Пользователи DHCP" на DHCP-сервере. Например, такой уровень доступа имеет место, когда выполнено одно из следующих условий:  

    -   указанный DHCP-сервер выполняет функцию DHCP-сервера для того сервера, который выполняет обнаружение;  

    -   компьютер, выполняющий обнаружение, и DHCP-сервер располагаются в одном домене;  

    -   между компьютером, выполняющим обнаружение, и DHCP-сервером существует двустороннее доверие;  

    -   сервер сайта входит в группу "Пользователи DHCP".  

-   В процессе опроса DHCP-сервера статические IP-адреса обнаруживаются не всегда. В частности, обнаружение сетевых ресурсов не позволяет находить IP-адреса, входящие в исключенный диапазон адресов на DHCP-сервере. Оно также не позволяет находить IP-адреса, зарезервированные для назначения вручную.  

**Домены**  

Укажите каждый домен, в котором следует делать запросы при обнаружении сетевых ресурсов.  

-   Учетная запись компьютера сервера сайта, выполняющего обнаружение, должна иметь доступ на чтение к контроллерам каждого из указанных доменов.  

-   Чтобы обнаруживать компьютеры из локального домена, необходимо включить службу браузера компьютеров хотя бы на одном компьютере в той же подсети, что и сервер сайта, выполняющий обнаружение сетевых ресурсов.  

-   Обнаружение сетевых ресурсов позволяет находить любой компьютер, который можно видеть с сервера сайта при обзоре сети.  

-   В ходе обнаружения сетевых ресурсов считывается IP-адрес, а затем с помощью ICMP-запросов проверяется связь с каждым найденным устройством. Команда **ping** помогает определить, какие компьютеры активные в настоящий момент.  

**SNMP-устройства:**  

Укажите каждое SNMP-устройство, к которому следует делать запросы при обнаружении сетевых ресурсов.  

-   В ходе обнаружения сетевых ресурсов с каждого SNMP-устройства, ответившего на запрос, считывается значение ipNetToMediaTable. Это значение представляет собой массивы IP-адресов клиентских компьютеров или других ресурсов, таких как принтеры, маршрутизаторы или другие устройства, поддерживающие IP-адресацию.  

-   Чтобы сделать запрос к устройству, необходимо указать его IP-адрес или NetBIOS-имя.  

-   Обнаружение сетевых ресурсов должно быть настроено для использования имени сообщества, присвоенного устройству — противном случае устройство отклонит SNMP-запрос.  

###  <a name="BKMK_LimitNetDisc"></a> Ограничение обнаружения сетевых ресурсов  
При запросе к SNMP-устройству на периметре сети в ходе обнаружения сетевых ресурсов может возвращаться информация о подсетях и SNMP-устройствах, находящихся за непосредственными пределами данной сети. Воспользуйтесь следующими сведениями для ограничения обнаружения сетевых ресурсов, указав SNMP-устройства, с которыми разрешено взаимодействие, а также сегменты сети, в которых следует делать запросы.  

**Подсети:**  

Укажите подсети, к которым будут делаться запросы при обнаружении сетевых ресурсов в вариантах с использованием SNMP-устройств и DHCP-серверов. В этих двух вариантах поиск будет производиться только в указанных подсетях.  

Например, в ответ на DHCP-запрос могут возвращаться сведения об устройствах, расположенных по всей сети. Если требуется обнаруживать устройства только в конкретной подсети, укажите и включите эту подсеть на вкладке **Подсети** диалогового окна **Свойства обнаружения сети**. Указывая и разрешая определенные подсети, вы ограничиваете будущие задачи обнаружения с использованием DHCP-серверов и SNMP-устройств этими подсетями.  

> [!NOTE]  
>  Указанные подсети не ограничивают круг объектов, которые обнаруживаются при запросах к **доменам**.  

**Имена SNMP-сообществ:**  

Для успешного запроса к SNMP-устройству при обнаружении сетевых ресурсов необходимо настроить обнаружение, указав имя сообщества для данного устройства. Если для обнаружения сетевых ресурсов не указано имя сообщества, присвоенное SNMP-устройству, устройство будет отклонять соответствующие запросы.  

**Максимальное число прыжков:**  

При указании максимального числа прыжков маршрутизатора ограничивается количество сетевых сегментов и маршрутизаторов, к которым могут делаться запросы при использовании SNMP.  

Указанное число прыжков ограничивает количество дополнительных устройств и сетевых сегментов, к которым могут выполняться запросы в ходе обнаружения сетевых ресурсов.  

Например, если настроить только обнаружение топологии и задать число прыжков, равное **0** (нулю), обнаруживаться будет только подсеть, в которой располагается исходный сервер, включая все маршрутизаторы в этой подсети.  

На приведенной ниже схеме показано, что будет найдено в результате запроса обнаружения сетевых ресурсов, настроенного только для определения топологии и выполняющегося на сервере 1 с максимальным числом прыжков 0: это подсеть D и маршрутизатор 1.  

 ![Обнаружение с маршрутизатором без прыжков](media/Disc-0.gif)  

 На приведенной ниже схеме показано, что будет найдено при обнаружении сетевых ресурсов, настроенном для определения топологии и поиска клиентов, если запрос выполняется на сервере 1 с максимальным числом прыжков 0: это подсеть D, маршрутизатор 1 и все потенциальные клиенты в подсети D.  

 ![Обнаружение с маршрутизатором с одним прыжком](media/Disc-1.gif)  

 Чтобы лучше представить себе, как увеличение максимального числа прыжков может увеличить количество обнаруживаемых сетевых ресурсов, рассмотрим следующую сеть:  

 ![Обнаружение с маршрутизатором с двумя прыжками](media/Disc-2.gif)  

 Запуск сетевого обнаружения на основе топологии с сервера 1 и с обнаружением следующих элементов за один проход маршрутизатора.  

-   Маршрутизатор 1 и подсеть 10.1.10.0 (найдено с нулевым количеством прыжков)  

-   Подсети 10.1.20.0 и 10.1.30.0, подсеть A и маршрутизатор 2 (найдено при первом прыжке)  

> [!WARNING]  
>  Каждое увеличение количества прыжков маршрутизатора может значительно увеличить число обнаруживаемых ресурсов и увеличить полосу пропускания сети, используемую функцией сетевого обнаружения.  

##  <a name="bkmk_aboutServer"></a> Обнаружение серверов  
**Возможность настройки**: нет  

Помимо перечисленных выше методов обнаружения, настраиваемых пользователем, Configuration Manager использует процесс так называемого **обнаружения серверов** (SMS_WINNT_SERVER_DISCOVERY_AGENT). В этом методе создаются записи о ресурсах для всех компьютеров, представляющих собой системы сайта, например для компьютера, который настроен в качестве точки управления.  

##  <a name="bkmk_shared"></a> Общие возможности методов обнаружения групп, систем и пользователей Active Directory  
В этом разделе содержатся сведения о функциях, которые являются общими для следующих методов обнаружения:  

-   Обнаружение групп Active Directory  

-   Обнаружение систем Active Directory  

-   обнаружение пользователей Active Directory  

> [!NOTE]  
>  Сведения в этом разделе не применяются к методу обнаружения в лесах Active Directory.  

Эти три метода обнаружения схожи в настройке и работе. Они позволяют обнаруживать компьютеры и пользователей, а также получать сведения о членстве в группах для ресурсов, хранящихся в доменных службах Active Directory. Процессом обнаружения управляет агент обнаружения, работающий на сервере каждого сайта, на котором должно выполняться обнаружение согласно настройкам. Каждый из этих методов обнаружения можно настроить для поиска в одном или нескольких местоположениях Active Directory как экземплярах местоположений в локальном лесу или удаленных лесах.  

Когда в ходе обнаружения ведется поиск ресурсов в ненадежном лесу, агент обнаружения должен быть в состоянии разрешать следующие имена:  

-   Чтобы найти ресурс компьютера при обнаружении систем Active Directory, агент обнаружения должен быть способен разрешить полное доменное имя ресурса. При невозможности разрешить полное доменное имя он предпримет попытку разрешить NetBIOS-имя ресурса.  

-   Чтобы найти пользователей и группы как ресурсы при обнаружении пользователей или групп Active Directory, агент обнаружения должен быть способен разрешить полное доменное имя контроллера домена для данного расположения Active Directory.  

Для каждого заданного расположения можно указать собственные параметры поиска, такие как рекурсивный поиск в дочерних контейнерах Active Directory данного расположения. Можно также указать уникальную учетную запись, которая будет использоваться для поиска в этом расположении. Тем самым обеспечивается гибкость: можно настроить определенный метод обнаружения на одном сайте для поиска в нескольких местоположениях Active Directory, принадлежащих множеству лесов, не прибегая к созданию единой учетной записи с разрешениями на доступ ко всем местоположениям.  

Когда обнаружение по каждому из трех этих методов выполняется на конкретном сайте, сервер данного сайта Configuration Manager обращается к ближайшему контроллеру домена в указанном лесу Active Directory для поиска ресурсов Active Directory. Домен и лес могут находиться в любом поддерживаемом режиме Active Directory. Учетная запись, назначаемая каждому экземпляру расположения, должна иметь разрешение **Чтение** для доступа к указанным расположениям Active Directory.

При обнаружении ведется поиск объектов в заданных расположениях, а затем предпринимается попытка собрать информацию об этих объектах. Если удается получить достаточно данных о ресурсе, создается запись обнаружения данных (DDR). Перечень необходимых данных зависит от используемого метода обнаружения.  

Если один и тот же метод обнаружения настраивается для выполнения на разных сайтах Configuration Manager с целью отправки запросов локальным серверам Active Directory, каждый сайт можно настроить для использования уникального набора вариантов обнаружения. Поскольку данные обнаружения являются общими для всех сайтов в иерархии, для эффективного однократного обнаружения каждого ресурса необходимо исключить перекрытие конфигураций.

В небольших средах каждый метод обнаружения рекомендуется выполнять только на одном сайте в иерархии. Это позволит сократить административную нагрузку и избежать множества действий по повторному обнаружению тех же самых ресурсов. Уменьшение числа сайтов, на которых выполняется поиск, может привести к сокращению общей используемой пропускной способности. Кроме того, может снизиться общее число создаваемых записей обнаружения данных, которые должны быть обработаны серверами сайта.  

Многие конфигурации методов обнаружения являются интуитивно понятными. Следующие разделы содержат дополнительные сведения о вариантах обнаружения, о которых, возможно, потребуется получить больше информации перед настройкой.  

Следующие возможности доступны для использования с несколькими методами обнаружения Active Directory:  

-   [Обнаружение изменений](#bkmk_delta)  

-   [Фильтрация устаревших записей о компьютерах по времени входа в домен](#bkmk_stalelogon)  

-   [Фильтрация устаревших записей по паролю компьютера](#bkmk_stalepassword)  

-   [Поиск настраиваемых атрибутов Active Directory](#bkmk_customAD)  

###  <a name="bkmk_delta"></a> Обнаружение изменений  
Доступно для:  

-   Обнаружение групп Active Directory  

-   Обнаружение систем Active Directory  

-   обнаружение пользователей Active Directory  

Обнаружение изменений является не независимым методом обнаружения, а режимом, доступным для соответствующих методов обнаружения. Обнаружение изменений выполняет поиск изменений конкретных атрибутов Active Directory, внесенных с момента последнего полного цикла обнаружения применимого метода обнаружения. Изменения атрибутов передаются в базу данных Configuration Manager для изменения записи ресурса обнаружения.  

По умолчанию цикл обнаружения изменений длится пять минут. Он выполняется гораздо чаще, чем типичный полный цикл обнаружения.  Такая частота выполнения возможна, поскольку обнаружение изменений использует меньше ресурсов сервера сайта и сети, чем полный цикл обнаружения. Если используется обнаружение изменений, можно реже выполнять полный цикл обнаружения для соответствующего метода.  

Вот наиболее распространенные виды изменений, которые могут выявляться в режиме обнаружения изменений:  

-   новых компьютеров или пользователей, добавленные в Active Directory;  

-   изменение основных сведений о компьютерах и пользователей;  

-   новые компьютеры или пользователи, добавленные в группу;  

-   компьютеры или пользователи, удаленные из группы.  

-   Изменения в объектах системных групп  

Хотя обнаружение изменений позволяет выявлять новые ресурсы и изменение членства в группах, оно не позволяет обнаруживать удаление ресурса из Active Directory. Записи данных обнаружения, создаваемые при обнаружении изменений, обрабатываются аналогично записям, созданным в результате полного цикла обнаружения.  

Обнаружение изменений настраивается на вкладке **Расписание опроса** в свойствах для каждого метода обнаружения.  

###  <a name="bkmk_stalelogon"></a> Фильтрация устаревших записей о компьютерах по времени входа в домен  
Доступно для:  

-   Обнаружение групп Active Directory  

-   Обнаружение систем Active Directory  

Функцию обнаружения можно настроить для исключения устаревших записей компьютеров на основе последнего входа в домен. Если этот параметр включен, метод обнаружения систем Active Directory выполняет оценку каждого обнаруженного компьютера. Метод обнаружения групп Active Directory оценивает каждый компьютер, входящий в обнаруженную им группу.  

Для использования этой возможности:  

-   Компьютеры должны быть настроены для изменения атрибута **lastLogonTimeStamp** в доменных службах Active Directory.  

-   Необходимо задать режим работы домена Active Directory не ниже Windows Server 2003.  

При настройке времени с момента последнего входа, которое будет использоваться для этого параметра, рекомендуется ввести интервал для репликации между контроллерами домена.  

Фильтрация настраивается на вкладке **Вариант** в диалоговых окнах **Свойства метода обнаружения систем Active Directory** и **Свойства метода обнаружения групп Active Directory**. Выберите параметр **Обнаруживать только те компьютеры, которые подключались к домену в течение указанного периода времени**.  

> [!WARNING]  
>  Если настроить этот фильтр и **фильтрацию устаревших записей по паролю компьютера**, те компьютеры, которые соответствуют условиям любого фильтра, исключаются из процесса обнаружения.  

###  <a name="bkmk_stalepassword"></a> Фильтрация устаревших записей по паролю компьютера  
Доступно для:  

-   Обнаружение групп Active Directory  

-   Обнаружение систем Active Directory  

Функцию обнаружения можно настроить для исключения устаревших записей компьютеров на основе последнего обновления пароля учетной записи компьютера. Если этот параметр включен, метод обнаружения систем Active Directory выполняет оценку каждого обнаруженного компьютера. Метод обнаружения групп Active Directory оценивает каждый компьютер, входящий в обнаруженную им группу.  

Для использования этой возможности:  

-   Компьютеры должны быть настроены для изменения атрибута **pwdLastSet** в доменных службах Active Directory.  

При настройке этого параметра, кроме ввода интервала для репликации между контроллерами домена, также рекомендуется добавить интервал для обновлений этого атрибута.  

Фильтрация настраивается на вкладке **Вариант** в диалоговых окнах **Свойства метода обнаружения систем Active Directory** и **Свойства метода обнаружения групп Active Directory**. Выберите параметр **Обнаруживать только те компьютеры, для которых в течение указанного периода времени изменялся пароль учетной записи компьютера**.  

> [!WARNING]  
>  Если настроить этот фильтр и **фильтрацию устаревших записей по времени входа в домен**, те компьютеры, которые соответствуют условиям любого фильтра, исключаются из процесса обнаружения.  

###  <a name="bkmk_customAD"></a> Поиск настраиваемых атрибутов Active Directory  
 Доступно для:  

-   Обнаружение систем Active Directory  

-   обнаружение пользователей Active Directory  

Каждый метод обнаружения поддерживает уникальный список атрибутов Active Directory, которые можно обнаружить.  

Просмотреть и настроить список настраиваемых атрибутов можно на вкладке **Атрибуты Active Directory** в диалоговых окнах **Свойства метода обнаружения систем Active Directory** и **Свойства метода обнаружения пользователей Active Directory**.  
