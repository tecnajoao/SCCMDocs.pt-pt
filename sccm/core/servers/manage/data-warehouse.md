---
title: "Хранилище данных | Документация Майкрософт"
description: "Сведения о точке обслуживания и базе данных хранилища данных для System Center Configuration Manager."
ms.custom: na
ms.date: 7/31/2017
ms.prod: configuration-manager
ms.reviewer: na
ms.suite: na
ms.technology: configmgr-other
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: aaf43e69-68b4-469a-ad58-9b66deb29057
caps.latest.revision: 
author: Brenduns
ms.author: brenduns
manager: angrobe
ms.openlocfilehash: eedbf12d3bf628666efc90c85a8dfab37e4dc9ab
ms.sourcegitcommit: 51fc48fb023f1e8d995c6c4eacfda7dbec4d0b2f
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/07/2017
---
#  <a name="the-data-warehouse-service-point-for-system-center-configuration-manager"></a>Точка обслуживания хранилища данных для System Center Configuration Manager
*Применимо к: System Center Configuration Manager (Current Branch)*

Начиная с версии 1702 вы можете использовать точку обслуживания хранилища данных, чтобы в течение длительного времени хранить исторические данные, необходимые для развертывания Configuration Manager, и создавать на их основе отчеты.

> [!TIP]
> Точка обслуживания хранилища данных появилась в версии 1702 в качестве функции предварительной версии. Сведения о ее включении см. в [этой статье](/sccm/core/servers/manage/pre-release-features).

> Начиная с версии 1706 она больше не считается функцией предварительной версии.

Хранилище данных вмещает до 2 ТБ данных и поддерживает метки времени для отслеживания изменений. Хранение данных достигается путем автоматической синхронизации базы данных сайта Configuration Manager с базой данных хранилища данных. После этого синхронизированные данные доступны в точке служб отчетов. Данные, синхронизированные с базой данных хранилища данных, сохраняются в течение трех лет. Периодически выполняется встроенная задача, которая удаляет данные старше трех лет.

Синхронизируемые данные (данные сайта и глобальные данные) включают в себя следующее:
- Работоспособность инфраструктуры
- Безопасность
- Соответствие требованиям
- Вредоносная программа   
- Развертывания программного обеспечения
- Сведения об инвентаризации (однако журнал инвентаризации не синхронизируется)

Во время установки роли системы сайта также устанавливается и настраивается база данных хранилища данных. Кроме того, устанавливаются несколько отчетов, используя которые вы можете легко найти и просмотреть эти данные.



## <a name="prerequisites-for-the-data-warehouse-service-point"></a>Предварительные требования для точки обслуживания хранилища данных
- Роль системы сайта для хранилища данных поддерживается только на сайте верхнего уровня в иерархии. (Это сайт центра администрирования или автономный первичный сайт.)
- На компьютере, на котором устанавливается эта роль системы сайта, требуется платформа .NET Framework 4.5.2 или более поздней версии.
- Учетная запись компьютера, на котором вы устанавливаете роль системы сайта, используется для синхронизации данных с базой данных хранилища данных. Она должна иметь следующие разрешения:  
  - права **администратора** на компьютере, где будет размещаться база данных хранилища данных;
  - разрешение **db_owner** на доступ к базе данных хранилища данных.
  - Разрешения **DB_reader** и **execute** для базы данных сайтов верхнего уровня.
- База данных хранилища данных должна работать под управлением SQL Server 2012 или более поздней версии. Можно использовать выпуски Standard, Enterprise или Datacenter.
- Для размещения базы данных хранилища можно использовать следующие конфигурации SQL Server:  
  - экземпляр по умолчанию;
  - именованный экземпляр;
  - группа доступности SQL Server AlwaysOn;
  - отказоустойчивый кластер SQL Server.
-   Если база данных хранилища данных расположена не на одном компьютере с базой данных сервера сайта, вам потребуется отдельная лицензия для каждого сервера SQL Server, на котором размещена база данных.
- Если вы используете [распределенные представления](/sccm/core/servers/manage/data-transfers-between-sites#bkmk_distviews), необходимо установить роль системы сайта для точки обслуживания хранилища данных на том же сервере, на котором размещена база данных сайта для сайта центра администрирования.



> [!IMPORTANT]  
> Хранилище данных не поддерживается, если на компьютере, на котором запущена точка обслуживания хранилища данных или на котором размещена база данных хранилища данных, используется один из таких языков:
> - JPN — японский;
> - KOR — корейский;
> - CHS — китайский (упрощенное письмо);
> - CHT — китайский (традиционное письмо). Эта проблема будет решена в будущих версиях.


## <a name="install-the-data-warehouse"></a>Установка хранилища данных
Каждая иерархия поддерживает один экземпляр этой роли, размещенный на любой системе сайта верхнего уровня. Сервер SQL Server, на котором размещена база данных хранилища данных, может быть локальным по отношению к роли системы сайта или удаленным. Хранилище данных работает с точкой служб отчетов, установленной на том же сайте, но на одном сервере необязательно устанавливать две роли системы сайта.   

Чтобы установить роль, используйте **мастер добавления ролей системы сайта** или **мастер создания сервера системы сайта**. Дополнительные сведения см. в разделе [Установка ролей системы сайта](/sccm/core/servers/deploy/configure/install-site-system-roles).  

При установке роли Configuration Manager создает базу данных хранилища данных в указанном экземпляре SQL Server. Если указать имя существующей базы данных (что потребуется при [перемещении базы данных хранилища данных на новый сервер SQL Server](#move-the-data-warehouse-database)), Configuration Manager не создает новую базу данных, а использует указанную.

### <a name="configurations-used-during-installation"></a>Конфигурации, используемые при установке
Страница **Выбор системной роли**:  

Страница **Общие**:
-   **Параметры подключения к базе данных хранилища данных Configuration Manager**:
 - **Полное доменное имя SQL Server**.  
 Укажите полное доменное имя сервера, на котором находится база данных для точки обслуживания хранилища данных.
 - **Имя экземпляра SQL Server, если применимо**.   
 Если вы не используете экземпляр SQL Server по умолчанию, следует указать его.
 - **Имя базы данных**.   
 Укажите имя базы данных хранилища данных. Длина имени базы данных не должна превышать 10 символов. (Поддерживаемая длина имени будет увеличена в будущем выпуске.)
 Configuration Manager использует это имя при создании базы данных хранилища данных. Если вы укажете имя уже существующей базы данных в этом экземпляре SQL Server, Configuration Manager будет использовать эту базу данных.
 - **Порт SQL Server, используемый для подключения**.   
 Укажите номер порта TCP/IP, настроенный для сервера SQL Server, на котором размещена база данных хранилища данных. Этот порт используется службой синхронизации для подключения к базе данных хранилища данных.  

Страница **Расписание синхронизации**:   
- **Расписание синхронизации**:
 - **Время начала**.  
 Укажите время, когда необходимо начать синхронизацию хранилища данных.
 - **Расписание повторения**:
    - **Ежедневно**. Настройте ежедневное выполнение синхронизации.
    - **Еженедельно**. Настройте еженедельное выполнение синхронизации, указав определенный день для выполнения этого процесса.

## <a name="reporting"></a>Отчеты
После установки точки обслуживания хранилища данных в точке служб отчетов, установленной на том же сайте, становятся доступными несколько отчетов. Если вы сперва установили точку обслуживания хранилища данных, эти отчеты будут автоматически добавлены во время установки точки служб отчетов.

Роль системы сайта "Хранилище данных" содержит следующие отчеты с категорией **Хранилище данных**:
 - **Развертывание приложений — журнал**.   
 Содержит сведения о развертывании определенного приложения на компьютере.
 - **Endpoint Protection and Software Update Compliance - Historical** (Endpoint Protection и соответствие обновлений ПО — журнал). Содержит сведения о компьютерах, на которых отсутствуют обновления программного обеспечения.  
 - **Общая инвентаризация оборудования — журнал**.   
 Содержит полные инвентарные данные по оборудованию на определенном компьютере.
 - **Общая инвентаризация ПО — журнал**.   
 Содержит полные инвентарные данные по программному обеспечению на определенном компьютере.
 - **Общие сведения о работоспособности инфраструктуры — журнал**.  
 Содержит общие сведения о работоспособности инфраструктуры Configuration Manager.
 - **Список обнаруженных вредоносных программ — журнал**.    
 Содержит сведения о вредоносных программах, обнаруженных в организации.
 - **Сводка распространения ПО — журнал**.   
 Сводка распространения программного обеспечения для определенного объявления и компьютера.


## <a name="expand-an-existing-stand-alone-primary-into-a-hierarchy"></a>Расширение имеющегося автономного первичного сайта в иерархии
Перед установкой сайта центра администрирования, используемого для расширения имеющегося автономного основного сайта, сначала необходимо удалить роль точки обслуживания хранилища данных. После установки сайта центра администрирования на нем можно установить роль системы сайта.  

В отличие от перемещения базы данных хранилища данных, это изменение приводит к потере исторических данных, синхронизированных ранее на основном сайте. Резервное копирование базы данных с основного сайта и восстановление его на сайте центра администрирования не поддерживается.




## <a name="move-the-data-warehouse-database"></a>Перенос базы данных хранилища данных
Чтобы перенести базу данных хранилища данных на новый сервер SQL Server, выполните указанные ниже действия.

1.  Используйте SQL Server Management Studio для резервного копирования базы данных хранилища данных. Затем восстановите эту базу данных в SQL Server на новом компьютере, на котором размещается хранилище данных.   
> [!NOTE]     
> После восстановления базы данных на новом сервере убедитесь в том, что разрешения на доступ к новой базе данных хранилища данных совпадают с исходными.  

2.  Чтобы удалить роль системы сайта "Точка обслуживания хранилища данных" с текущего сервера, используйте консоль Configuration Manager.
3.  Повторно установите точку обслуживания хранилища данных и укажите имя нового сервера и экземпляра SQL Server, где размещается восстановленная база данных хранилища данных.
4.  После установки роли системы сайта перемещение завершено.

## <a name="troubleshooting-data-warehouse-issues"></a>Устранение неполадок хранилища данных
**Файлы журнала**:  
Чтобы изучить проблемы, возникающие при установке точки обслуживания хранилища данных или синхронизации данных, используйте следующие журналы:
 - *DWSSMSI.log* и *DWSSSetup.log* — используйте эти журналы для изучения ошибок, возникающих при установке точки обслуживания хранилища данных.
 - *Microsoft.ConfigMgrDataWarehouse.log* — используйте этот журнал для изучения ошибок синхронизации данных между базой данных сайта и базой данных хранилища данных.

**Сбой при установке**  
 Установка точки обслуживания хранилища данных на удаленном сервере системы сайта завершается сбоем, если на этом компьютере еще не установлены роли системы сайта.  
  - **Решение.**   
    Убедитесь, что на компьютере, где вы устанавливаете точку обслуживания хранилища данных, содержится как минимум еще одна роль системы сайта.  


**Известные проблемы с синхронизацией**   
Синхронизация завершается сбоем, и в журнале *Microsoft.ConfigMgrDataWarehouse.log* регистрируется **ошибка заполнения объектов схемы**.  
 - **Решение.**  
    Убедитесь, что учетная запись компьютера, на котором размещена роль системы сайта, имеет разрешение **db_owner** на доступ к базе данных хранилища данных.

Не удается открыть отчеты хранилища данных, если база данных хранилища данных и точка служб отчетов расположены в разных системах сайта.  

 - **Решение.**  
    Предоставьте **учетной записи точки служб отчетов** разрешение **db_datareader** на доступ к базе данных хранилища данных.

При открытии отчета хранилища данных возвращается следующая ошибка:

*Произошла ошибка при обработке отчета. (rsProcessingAborted) Не удалось установить соединение с источником данных "AutoGen__39B693BB_524B_47DF_9FDB_9000C3118E82_". (rsErrorOpeningConnection) Подключение к серверу успешно установлено, но затем произошла ошибка в процессе подтверждения, предшествующего входу. (Поставщик: поставщик SSL, ошибка: 0 — цепочка сертификатов выпущена центром сертификации, не имеющим доверия.)*

- **Решение.** Чтобы настроить сертификаты, выполните следующие действия:

  1. На компьютере, на котором размещена база данных хранилища данных, сделайте следующее:

    1. Откройте IIS, выберите **Сертификаты сервера**, щелкните правой кнопкой мыши **Создать самозаверяющий сертификат**, а затем укажите понятное имя сертификата, например **Сертификат идентификации сервера SQL Server хранилища данных**. Выберите **личное** хранилище сертификатов.
    2. В разделе **Сетевая конфигурация SQL Server** откройте **диспетчер конфигурации SQL Server**, а затем щелкните правой кнопкой мыши в разделе **Protocols for MSSQLSERVER** (Протоколы для MSSQLSERVER) и выберите **Свойства**. Затем на вкладке **Сертификат** в качестве сертификата выберите **сертификат идентификации сервера SQL Server хранилища данных** и сохраните изменения.  
    3. В разделе **Службы SQL Server** откройте **диспетчер конфигурации SQL Server**, а затем перезапустите **службу SQL Server** и **Reporting Services**.
    4.  Откройте консоль управления (MMC) и добавьте оснастку **Сертификаты**. Для управления сертификатом выберите **учетную запись локального компьютера**. Затем в окне консоли управления разверните папку **Личное**, выберите **Сертификаты** и экспортируйте **сертификат идентификации сервера SQL Server хранилища данных** в формате **двоичного файла X.509 (CER) в кодировке DER**.    
  2.    На компьютере, где размещена среда SQL Server Reporting Services, откройте консоль управления и добавьте оснастку **Сертификаты**. Затем выберите действие управления сертификатами для **учетной записи компьютера**. В папке **Trusted Root Certificate Authorities** (Доверенные корневые центры сертификации) импортируйте **сертификат идентификации сервера SQL Server хранилища данных**.


## <a name="data-warehouse-dataflow"></a>Поток данных хранилища данных   
![Datawarehouse_flow](./media/datawarehouse.png)

**Хранение и синхронизация данных**

| Шаг   | Подробные сведения  |
|:------:|-----------|  
| **1**  |  Сервер сайта передает и сохраняет данные в базе данных сайта.  |  
| **2**  |      В соответствии с расписанием и конфигурацией точка обслуживания хранилища данных получает данные из базы данных сайта.  |  
| **3**  |  Точка обслуживания хранилища данных передает и сохраняет копию синхронизированных данных в базе данных хранилища данных. |  
**Отчеты**

| Шаг   | Подробные сведения  |
|:------:|-----------|  
| **А**  |  С помощью встроенных отчетов пользователь запрашивает данные. Этот запрос передается в точку служб отчетов с помощью SQL Server Reporting Services. |  
| **Б**  |      Большинство отчетов служат для получения текущей информации, и соответствующие запросы выполняются к базе данных сайта. |  
| **В**  | Когда отчет запрашивает исторические данные с использованием одного из отчетов, *категория* которых представлена **хранилищем данных**, такой запрос направляется к базе данных хранилища данных.   |  
